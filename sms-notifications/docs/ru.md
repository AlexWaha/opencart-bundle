# Alexwaha.com - SMS уведомления

**Модуль для OpenCart v2.3 - 3.x**

---

## Описание

Это дополнение содержит модуль и SMS шлюзы для популярных сервисов рассылок.

Модуль позволяет отправлять SMS уведомления администраторам и покупателям о различных событиях в магазине: новые заказы, смена статуса заказа, регистрация, новые отзывы.

> **Видео инструкция (старая):** Перед установкой дополнения, посмотрите [YouTube видео на русском языке](https://youtu.be/JPxS5-U6X20)

---

## Инструкция по установке

### Требования и этапы установки

1. **Установка основного модуля**

   Убедитесь в том, что у Вас установлен модуль **[aw_core_oc2.3-3.x.ocmod.zip](https://github.com/AlexWaha/opencart-bundle/blob/master/Core/dist/aw_core_oc2.3_3.x.ocmod.zip)**

   > Это вспомогательный функционал для работы всех моих модулей.

   > **Критически необходимо**, без него работать модуль не будет

2. **Настройки FTP-загрузки (только для OpenCart 2.x)**

   Убедитесь в том, что у Вас установлен модуль отключающий FTP-загрузку дополнений в OpenCart 2.x или у Вас корректные настройки FTP в настройках магазина

   > [Ссылка на модуль отключающий FTP-загрузку только для OpenCart v2.3](https://www.opencart.com/index.php?route=extension/extension/info&extension_id=18892) **(Для OpenCart 3.x не требуется)**

3. **Установите архив aw_sms_notify_oc2.3-3.x.ocmod.zip через админ-панель сайта**

4. **Обновите кеш модификаций**

5. **Включение модуля**

   В разделе: **Расширения → Модули** → Включите модуль **alexwaha.com - SMS уведомления**

   > При включении модуль автоматически удалит файлы старых версий, установит События и Права

### Самопроверка после установки

- Проверить наличие модуля в списке дополнений
- Проверить наличие в **Дополнения → События** значений: `aw_sms_notify_order_alert`, `aw_sms_notify_review_alert`, `aw_sms_notify_register_alert`
- Обновить кеш модификаций

---

## Настройка

### 1. Настройка шлюза

Зайдите в настройки модуля **Дополнения → Модули → alexwaha.com - SMS уведомления**

На вкладке **"Настройки шлюза"** задайте необходимые настройки для подключения к SMS шлюзу:

- **SMS шлюз** - Выбрать шлюз из списка доступных
- **Отправитель** - Указать зарегистрированное Имя-отправителя (Альфа-имя) 11 символов латиницей без пробелов (регистрируется в личном кабинете Вашего сервиса рассылок)
- **Номер телефона администратора** - Указать номер телефона в международном формате для уведомлений о новых заказах или новых отзывах на товар, например: +1(код оператора) 1234567
- **Дополнительные номера** - Номера на которые будут приходить копии уведомлений (как для администратора). Введите номера через запятую без пробелов в международном формате
- **Логин на SMS шлюз (или API KEY)** - Логин или API ключ для подключения к сервису рассылки (данная информация находится в личном кабинете используемого сервиса рассылки)
- **Пароль на SMS шлюз** - Пароль для SMS шлюза (если используется API ключ для подключения к шлюзу, пароль вероятно можно оставить пустым)

### 2. Настройка логирования

На вкладке **"Логи шлюза"**:

- Вы можете задать произвольное название файла логов
- В логах будет храниться информация об отправках, ошибках и прочее связанное с выбранным шлюзом для отправки SMS

### 3. Настройка уведомлений

На вкладке **"Настройки уведомлений"** необходимо включить только необходимые уведомления:

- **Отправить SMS админу** - уведомление администратору о новом заказе магазина
- **Отправить SMS покупателю** - уведомление покупателю о новом заказе на номер указанный в заказе (ниже в блоке "SMS для групп покупателей" необходимо указать для каких групп покупателей будет производиться отправка)
- **SMS покупателю при регистрации** - уведомление покупателю о регистрации (позволяет отправить данные для входа)
- **SMS при смене статуса заказа** - уведомление о смене статуса заказа менеджером, модулем доставки или автоматически
- **SMS для новых отзывов** - уведомление администратору при поступлении нового отзыва на товар
- **Форсировать отправку SMS** - Принудительная отправка уведомлений (необходимо, если запрос на отправку уведомлений о смене статуса заказа будут производиться сторонними дополнениями)
- **Транслит текста SMS** - Преобразование кириллицы в латиницу (для сокращения кол-ва отправленных SMS, лучше использовать транслитерацию. Кириллицей в 1 SMS помещается 70 символов, латиницей 140 символов)

> **Важно:** Во избежание ошибок отправки, не включайте транслит, если в шаблонах Вы уже указываете текст латиницей

- **SMS для групп покупателей** - Автоматическая отправка уведомлений только для выбранных групп покупателей. Если нет отмеченных групп, уведомления будут отправляться всем покупателям
- **SMS для способов оплаты** - Автоматическая отправка уведомлений только для выбранных способов оплаты после оформления заказа
- **SMS для статусов** - Автоматическая отправка уведомлений для выбранных статусов заказа при смене статуса заказа
- **Заготовки для SMS при просмотре заказа** - Здесь можно указать часто используемые тексты для уведомлений при отправке уведомлений менеджером вручную из формы при просмотре заказа

### 4. Настройка уведомлений Viber

На вкладке **"Настройки Viber - Настройки уведомлений"** при необходимости, можно настроить отправку уведомлений в Viber:

- **Отправить Viber сообщения** - Включить/Выключить отправку в Viber
- **Имя отправителя Viber** - Указать зарегистрированное Viber Имя-отправителя или общее имя предоставленное Вашим сервисом рассылок
- **Время жизни Viber сообщения** - Время в секундах, за которое сообщение в Viber будет доставлено (если за указанный промежуток времени уведомление не будет доставлено или на указанном номере нет Viber-аккаунта, будет отправлено SMS сообщение)
- **Изображение в Viber сообщения** - Изображение которое будет выводиться в каждом Viber сообщении (можно указать логотип магазина. Высота и ширина картинки по-умолчанию 400*400px, изображение должно быть квадратным)
- **Надпись на кнопке Viber сообщения и Ссылка на кнопке** - Параметры которые необходимо указать, если в Viber сообщении нужно показать кнопку со ссылкой

### 5. Шаблоны уведомлений

На вкладках **"Шаблон SMS покупателю"** и **"Шаблон SMS администратору"** задаете тексты SMS уведомлений используя текст и переменные из вкладки **"Переменные"**.

**Доступные переменные** можно посмотреть на вкладке "Список переменных".

### Использование переменной {{products}}

Переменная `{{products}}` в прямом виде не указывается. Чтобы ее использовать необходимо придерживаться синтаксиса TWIG-шаблонизатора:

```twig
{% for product in products %}
Товар: {{product.name}}
Модель: {{product.model}}
Цена: {{product.price}}
Количество: {{product.quantity}}
{% endfor %}
```

---

## Произвольное SMS

На вкладке **"Произвольное SMS"** доступна служебная функция для тестирования отправки или произвольного SMS на указанный номер телефона.

**Применение:**
- Тестирование работы SMS шлюза
- Отправка произвольных SMS сообщений
- Проверка подключения к сервису рассылок

**Использование:**
1. Укажите номер телефона в международном формате (например: +1234567890)
2. Введите текст SMS сообщения
3. Нажмите кнопку отправки

---

## Список готовых интеграций/шлюзов

Модуль поддерживает более 30 SMS-шлюзов:

1. Alphasms.ua - HTTP-протокол (cURL), авторизация через Логин и Пароль или только через Логин (API key). Доступна гибридная отправка Viber+SMS
2. Bytehand.com - HTTP-протокол (cURL), авторизация через Логин и Пароль
3. Devinotele.com - HTTP-протокол (cURL), авторизация через Логин и Пароль
4. Epochtasms - HTTP-протокол (XML+cURL), авторизация через Логин и Пароль
5. Eskiz.uz - HTTP-протокол (cURL), авторизация через Логин(Email) и Пароль
6. Infosmska.ru - HTTP-протокол (cURL), авторизация через Логин и Пароль
7. Intel-tele.com - HTTP-протокол (cURL), авторизация через Логин и Пароль(API Key)
8. Iqsms.ru - HTTP-протокол (cURL), авторизация через Логин и Пароль
9. Letsads.com - HTTP-протокол (XML+cURL), авторизация через Логин и Пароль
10. Mainsms.ru - HTTP-протокол (cURL), авторизация через Логин и Пароль
11. Nikita.kg - HTTP-протокол (XML+cURL), авторизация через Логин и Пароль
12. Osonsms.com - HTTP-протокол (cURL), авторизация через Логин и Пароль
13. Prostor-sms.ru - HTTP-протокол (cURL), авторизация через Логин и Пароль
14. Rocketsms.by - HTTP-протокол (cURL), авторизация через Логин и Пароль
15. Smsaero.ru - HTTP-протокол (cURL), авторизация через Логин и Пароль
16. Smsassistent.by - HTTP-протокол (cURL), авторизация через Логин и Пароль
17. Smscab.ru - HTTP-протокол (cURL), авторизация через Логин и Пароль
18. Smsclub.mobi - HTTP-протокол (cURL), авторизация через Логин и Пароль
19. Smsc.ru, Smsc.ua, Smsc.kz - HTTP-протокол (cURL), авторизация через Логин и Пароль
20. Smsfeedback.ru - HTTP-протокол (cURL), авторизация через Логин и Пароль
21. Sms-fly.ua - HTTP-протокол (XML+cURL), авторизация через Логин и Пароль
22. Smsgorod.ru - HTTP-протокол (cURL), авторизация через Логин (Api key)
23. Smspilot.ru - HTTP-протокол (cURL), авторизация через Логин и Пароль
24. Sms.ru - HTTP-протокол (cURL), авторизация через Логин и Пароль
25. Sms-sending.ru - HTTP-протокол (XML+cURL), авторизация через Логин и Пароль
26. Smstraffic.ru - HTTP-протокол (cURL), авторизация через Логин и Пароль
27. Smssimple.ru - HTTP-протокол (cURL), авторизация через Логин и Пароль
28. Sms-uslugi.ru - HTTP-протокол, авторизация через Логин и Пароль
29. Stream-telecom.ru - HTTP-протокол, авторизация через Логин и Пароль
30. Targetsms.ru - HTTP-протокол, авторизация через Логин и Пароль
31. Turbosms.ua (HTTP) - HTTP-протокол (cURL), авторизация через Логин (API key). Доступна гибридная отправка Viber+SMS
32. Unisender.com - HTTP-протокол (cURL), авторизация через Логин (API key)
33. Smssimple.ru - HTTP-протокол (cURL), авторизация через Логин и Пароль
34. Testsms - Тестовый шлюз, только записывает текст SMS и дату создания в логи модуля

---

## Интеграция с другими модулями

Модуль поддерживает интеграцию со следующими модулями доставки:

### Новая почта API (от Prorab337)

- Скачайте и установите архив `novaposhta_aw_sms_notify_oc2_3.ocmod.zip`
- В модуле Новая Почта API на вкладке "Задания Cron" задайте необходимые настройки
- Добавьте команду из поля **Отслеживание отправлений** в планировщик CRON на сервере

> **Важно!** Чтобы SMS отправилась, напротив нужного статуса отметить пункт "Для покупателя о смене статуса" и составить шаблон сообщения в модуле Новая Почта API. В модуле SMS уведомлений для соответствующего статуса указать только переменную `{{ order_comment }}`

### Укрпочта API (от Prorab337)

- Скачайте и установите архив `ukposhta_aw_sms_notify_oc2_3.ocmod.zip`
- Настройки задаются аналогично как и для модуля Новая почта API

### Justin API (от Prorab337)

- Скачайте и установите архив `justin_aw_sms_notify_oc2_3.ocmod.zip`
- Настройки задаются аналогично как и для модуля Новая почта API

---

## Импорт и экспорт настроек

Модуль поддерживает функционал импорта и экспорта настроек для удобного переноса конфигурации между магазинами.

### Экспорт настроек

На вкладке **"Импорт и экспорт"** вы можете экспортировать текущие настройки модуля:

1. Нажмите кнопку **"Экспорт"**
2. Текущие настройки модуля будут сохранены в JSON файл
3. Файл автоматически скачается на ваш компьютер

> **Примечание:** Экспортируются все настройки модуля: шлюз, шаблоны SMS, параметры уведомлений, настройки Viber и т.д.

### Импорт настроек

Для загрузки ранее сохраненных настроек:

1. На вкладке **"Импорт и экспорт"** выберите JSON файл с настройками
2. Нажмите кнопку **"Импорт"**
3. Настройки будут загружены и применены

> **Важно!** Импорт настроек заменит все текущие настройки модуля. Рекомендуется сделать экспорт текущих настроек перед импортом.

**Применение:**
- Перенос настроек между тестовым и продакшн магазином
- Резервное копирование конфигурации модуля
- Быстрая настройка модуля на новом магазине

---

## Разработчикам

Через модуль **alexwaha.com - SMS уведомления** можно осуществлять отправку сообщений из других источников.

### Подключение модели (только для директории catalog):

```php
$this->load->model('extension/module/aw_sms_notify');
```

### Подготовка данных для отправки:

```php
$smsData = [
    'phone' => '+1234567890',
    'message' => 'Текст SMS сообщения'
];
```

Где, `phone` - Номер телефона в международном формате; `message` - Текст сообщения

### Отправка данных:

```php
$this->model_extension_module_aw_sms_notify->sendMessage($smsData);
```

Возвращает `bool`: **true** - данные верны и были отправлены, **false** - если phone или message отсутствуют.

Фактическая отправка SMS видна в логе модуля и в Панеле управления SMS сервиса.

---

## Возможные ошибки и решения

### Если никакие SMS не отправляются:

1. **Проверьте средства на балансе в сервисе рассылок**
2. **Проверьте корректность логина и пароля** - Очень часто логин и пароль для подключения к SMS шлюзу отличаются от доступов к Личному Кабинету в SMS сервисе
3. **Проверьте логи шлюза** - Если подключение настроено правильно, шлюз будет записывать в логи возможные ошибки
4. **Проверьте регистрацию Альфа-имя/Подпись отправителя** - Возможно подпись не одобрена или Вы еще не регистрировали ее

### Если не отправляется SMS при смене статуса заказа:

1. **Проверьте настройки модуля** - SMS при смене статуса должно быть включено, выбраны статусы, заданы шаблоны SMS
2. **Проверьте наличие событий** - В разделе Расширения - События должны присутствовать записи `aw_sms_notify_order_alert`
3. **Сторонний модуль управления заказами** - Если используются модули типа **Управление торговли от Newstore, OrderPro, Order Manager Pro**, необходимо установить дополнительные интеграции из папки `sms-notification/dist/3rd-party`

### Рекомендации:

1. Номера телефонов при заказе должны быть в международном формате, поэтому установите маску на поле телефона
2. Используйте транслитерацию кириллических сообщений для экономии на рассылках
3. Если Вы не уверены, что сможете настроить модуль, обращайтесь за платной настройкой по контактам ниже

---

## Лицензия

Этот проект распространяется под лицензией [GNU General Public License version 3 (GPLv3)](https://github.com/alexwaha/opencart-bundle/blob/master/LICENSE).

Права и авторство на ПО принадлежат разработчику Ваховскому Александру Витальевичу (Alexwaha), сайт [https://alexwaha.com](https://alexwaha.com)

---

## Поддержка и контакты

> **Внимание!** Техническая поддержка модуля оказывается только на платной основе. Устранение ошибок в основном репозитории проводится без регламента при наличии свободного времени у разработчика. Если Вы можете предложить решение какой-то проблемы, [pull-request на GitHub](https://github.com/AlexWaha/opencart-bundle/pulls) приветствуется.

**Платные услуги:** Настройка модуля автором, доработка, исправление конфликтов с другими модулями, интеграция с шаблоном, интеграция с другим модулем в Вашем проекте - только на **платной основе**, обращайтесь по контактам ниже.

**Протестировано:** На чистом OpenCart и на шаблоне по умолчанию (Default).

### Контактная информация

- **Telegram:** [@alexwaha_dev](https://t.me/alexwaha_dev)
- **Email:** [support@alexwaha.com](mailto:support@alexwaha.com)
- **Bug Report:** [GitHub Issues](https://github.com/AlexWaha/opencart-bundle/issues)
- **Contact Form:** [https://alexwaha.com/contact](https://alexwaha.com/contact)

---

Сделано с ☕ [Alexwaha.com](https://alexwaha.com)
