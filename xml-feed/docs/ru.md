# Инструкция | Alexwaha.com - XML Feed

**для Opencart v2.3 - 3.x**

---

## Содержание

1. [Информация о модуле](#информация-о-модуле)
2. [Инструкция по установке](#инструкция-по-установке)
3. [Общие настройки](#общие-настройки)
4. [Создание и настройка XML фидов](#создание-и-настройка-xml-фидов)
5. [Шаблоны XML фидов](#шаблоны-xml-фидов)
6. [Генерация XML фидов](#генерация-xml-фидов)
7. [Автоматизация через Cron](#автоматизация-через-cron)
8. [Переменные для шаблонов](#переменные-для-шаблонов)
9. [Для разработчиков](#для-разработчиков)
10. [Возможные ошибки и рекомендации](#возможные-ошибки-и-рекомендации)
11. [Лицензия и контакты](#лицензия-и-контакты)

---

## Информация о модуле

**XML Feed** - это модуль для OpenCart, который позволяет создавать и автоматически генерировать XML фиды товаров для различных торговых площадок и рекламных платформ.

### Основные возможности:

- **Множественные XML фиды** - Создание неограниченного количества фидов для разных площадок
- **Готовые шаблоны** - Встроенные шаблоны для популярных платформ (Google, Facebook, Prom.ua, Hotline.ua, YML)
- **Гибкая фильтрация** - Выбор категорий, производителей, атрибутов и опций для экспорта
- **Автоматизация** - Генерация через Cron задачи или вручную
- **Настройка изображений** - Контроль размера и количества изображений
- **Мультиязычность** - Поддержка нескольких языков для экспорта
- **Мультивалютность** - Экспорт цен в различных валютах
- **Информация о доставке** - Настройка данных о доставке и гарантии
- **Безопасность** - Защита доступа к фидам ключом

### Технические характеристики:

- **Автор:** Alexander Vakhovski (AlexWaha)
- **Сайт:** [https://alexwaha.com](https://alexwaha.com)
- **Лицензия:** GPLv3
- **Совместимость:** OpenCart 2.3.x - 3.x
- **Код модуля:** `aw_xml_feed`

---

## Инструкция по установке

### Шаг 1: Предварительные требования

1. Убедитесь в том, что у Вас установлен модуль **[aw_core_oc2.3-3.x.ocmod.zip](https://github.com/AlexWaha/opencart-bundle/blob/master/Core/dist/aw_core_oc2.3_3.x.ocmod.zip)**

   > **Важно:** Это вспомогательный функционал для работы всех модулей AlexWaha

2. Для OpenCart 2.3.x убедитесь, что у Вас установлен модуль, отключающий FTP-загрузку дополнений, или у Вас корректные настройки FTP в настройках магазина

   > **Примечание:** Для OpenCart 3.x это не требуется

   [Ссылка на модуль отключающий FTP-загрузку (только для Opencart v2.3)](https://www.opencart.com/index.php?route=extension/extension/info&extension_id=18892)

### Шаг 2: Установка модуля

1. Установите архив **aw_xml_feed_oc2.3-3.x.ocmod.zip** через админ-панель сайта

   - Перейдите в **Расширения → Установщик**
   - Загрузите архив модуля
   - Дождитесь завершения установки

2. Обновите кеш модификаций

   - Перейдите в **Расширения → Модификаторы**
   - Нажмите кнопку **Обновить**

3. В разделе **Расширения → Каналы продвижения** найдите и включите модуль:

   **alexwaha.com - XML Feed**

   > **Важно:** При включении модуль автоматически создаст таблицу в БД и установит права доступа

### Шаг 3: Самопроверка после установки

Проверьте корректность установки:

- ✓ Модуль присутствует в списке каналов продвижения
- ✓ Страница настроек модуля открывается без ошибок
- ✓ В каталоге создана папка для XML файлов (по умолчанию `xml-feed`)

---

## Общие настройки

Перейдите в настройки модуля: **Расширения → Каналы продвижения → alexwaha.com - XML Feed**

### Основные параметры

#### Статус модуля
- **Включено** - Модуль активен и работает
- **Отключено** - Модуль отключен, генерация XML фидов невозможна

#### Имя папки XML
Укажите название папки для хранения сгенерированных XML файлов.

**По умолчанию:** `xml-feed`

**Требования:**
- От 3 до 64 символов
- Используйте только латинские буквы, цифры и дефисы
- Без пробелов и спецсимволов

**Пример:** `product-feeds` или `xml-export`

> **Важно:** Папка будет создана автоматически в корне сайта при первой генерации фида

#### Размер пакета генерации
Количество товаров, обрабатываемых за один раз при генерации XML.

**Рекомендуемое значение:** 250-500

**Максимальное значение:** 1000

> **Совет:** Если на сервере возникают ошибки timeout, уменьшите размер пакета до 100-250

#### Ключ доступа
Уникальный ключ для защищенного доступа к генерации XML фидов.

**Требования:**
- Минимум 8 символов
- Генерируется автоматически при установке
- Можно изменить вручную

> **Безопасность:** Не используйте простые ключи типа `12345678`. Ключ защищает ваши фиды от несанкционированного доступа

### Информация о магазине

#### Название магазина
Официальное название вашего магазина для экспорта в XML.

**Требования:** От 3 до 255 символов

**Для каждого языка отдельно**

**Пример:**
- Русский: `Интернет-магазин электроники`
- English: `Electronics Online Store`

#### Название компании
Юридическое название компании или ИП.

**Требования:** От 3 до 255 символов

**Для каждого языка отдельно**

**Пример:**
- Русский: `ООО "Электроника для всех"`
- English: `Electronics For All LLC`

#### Описание магазина
Краткое описание деятельности магазина.

**Требования:** От 10 до 255 символов

**Для каждого языка отдельно**

**Пример:**
```
Продажа электроники, компьютеров,
смартфонов и аксессуаров с доставкой
по всей стране. Официальная гарантия.
```

#### Страна магазина
Выберите страну, где зарегистрирован ваш магазин.

> **Применение:** Используется в XML фидах для указания страны происхождения товаров

### Настройки доставки

#### Выводить информацию о доставке
Включает/отключает вывод блоков доставки во всех XML фидах модуля.

- **Включено** - Информация о доставке будет добавлена в XML
- **Отключено** - Информация о доставке не будет включена

#### Служба доставки
Название службы доставки или способа доставки.

**Требования:** От 3 до 255 символов (если заполнено)

**Для каждого языка отдельно**

**Примеры:**
- `Новая Почта`
- `Курьерская доставка`
- `DHL Express`

#### Срок доставки в днях
Количество дней доставки.

**Требования:** От 1 до 365 дней

**Примеры:**
- `1` - доставка на следующий день
- `3` - доставка за 3 дня
- `7` - доставка за неделю

#### Цена доставки
Стоимость доставки в валюте магазина по умолчанию.

**Требования:** Положительное число или 0 для бесплатной доставки

**Примеры:**
- `0` - бесплатная доставка
- `150` - доставка $150
- `500` - доставка $500

### Настройки гарантии и наличия

#### Статический текст - Гарантия
Текст гарантии, который будет использоваться, если для товара не указан атрибут гарантии.

**Требования:** От 3 до 255 символов (если заполнено)

**Для каждого языка отдельно**

**Примеры:**
- `12 месяцев`
- `24 месяца от производителя`
- `Гарантия магазина 1 год`

#### Статусы товаров при которых их можно приобрести
Выберите статусы складского учета, при которых товары считаются доступными для покупки.

**Примеры:**
- В наличии
- Под заказ
- Предзаказ

> **Важно:** Товары со статусами НЕ из этого списка будут помечены как "out of stock" (нет в наличии)

### Ссылка для генерации фида

После сохранения общих настроек появится ссылка для ручного запуска генерации всех активных XML фидов:

```
https://ваш-сайт.com/index.php?route=extension/feed/aw_xml_feed&access_key=ваш_ключ
```

> **Применение:** Используйте эту ссылку для тестирования генерации или ручного обновления фидов

---

## Создание и настройка XML фидов

### Список XML фидов

На главной странице модуля отображается таблица всех созданных XML фидов:

| Колонка | Описание |
|---------|----------|
| **Название** | Название фида для идентификации |
| **Шаблон** | Используемый шаблон XML |
| **Имя файла** | Название XML файла |
| **Ссылка на прайс** | URL адрес сгенерированного XML файла |
| **Состояние** | Включен / Отключен |
| **Действие** | Редактировать / Удалить |

### Создание нового XML фида

Нажмите кнопку **"Создать"** для открытия формы создания фида.

#### Вкладка "Общие"

##### Название
Внутреннее название фида для идентификации в админ-панели.

**Требования:** От 3 до 256 символов

**Примеры:**
- `Google Merchant Feed`
- `Facebook Catalog`
- `Prom.ua Export`

##### Название файла *.xml
Имя XML файла без расширения.

**Требования:** От 3 до 128 символов

**Используйте:** Латинские буквы, цифры, дефисы

**Примеры:**
- `google-feed`
- `facebook-catalog`
- `prom-export`

> **Важно:** Расширение `.xml` добавляется автоматически

##### Шаблон XML
Выберите шаблон для генерации XML фида:

- **Google** - Google Merchant Center (Google Shopping)
- **Facebook** - Facebook Product Catalog
- **Hotline** - Hotline.ua (Украина)
- **Prom** - Prom.ua (Украина)
- **YML** - Rozetka и др.

> **Примечание:** Каждый шаблон имеет свою структуру XML, соответствующую требованиям площадки

##### Язык экспорта
Выберите язык, на котором будут экспортированы названия и описания товаров.

**Применение:**
- Экспорт на русском для русскоязычных площадок
- Экспорт на английском для международных площадок
- Создание разных фидов для разных языков

##### Валюта экспорта
Выберите валюту для цен в XML фиде.

**Примечание:** Курс валют используется из настроек магазина OpenCart

**Применение:**
- UAH для украинских площадок
- USD/EUR для международных площадок

##### Использовать оригиналы изображений
- **Включено** - Использовать оригинальные изображения без изменения размера
- **Отключено** - Изображения будут изменены до указанных размеров

> **Рекомендация:** Отключите для уменьшения размера изображений и ускорения загрузки на площадках

##### Ширина изображений
Ширина изображений в пикселях (если не используются оригиналы).

**По умолчанию:** 800

**Рекомендации:**
- **Google/Facebook:** 800-1200 пикселей
- **Prom.ua/Hotline:** 600-800 пикселей
- **YML:** 600-1000 пикселей

##### Высота изображений
Высота изображений в пикселях (если не используются оригиналы).

**По умолчанию:** 800

> **Совет:** Используйте квадратные изображения (одинаковые ширина и высота) для лучшего отображения на площадках

##### Кол-во изображений
Количество дополнительных изображений товара в экспорте.

**Требования:** От 0 до 8

**Рекомендовано:** 4-6 изображений

> **Примечание:** Большинство площадок принимает от 1 до 10 изображений на товар

##### Состояние
- **Включено** - Фид активен и будет генерироваться
- **Отключено** - Фид не будет генерироваться при автоматическом обновлении

---

#### Вкладка "Категории"

##### Категории доступные для экспорта
Выберите категории товаров, которые будут включены в XML фид.

**Как выбрать:**
1. Отметьте чекбоксы нужных категорий
2. При выборе родительской категории автоматически выбираются все подкатегории

**Если не выбрано ни одной категории:**
- В фид попадут товары из всех категорий (с учетом фильтра по производителям)

##### Название категорий в экспорте
Переопределите названия категорий для экспорта (например, для Google Merchant).

**Применение:**
- Сопоставление с категориями Google Product Taxonomy
- Адаптация названий под требования площадки

**Пример:**
- Ваша категория: `Смартфоны`
- Название в экспорте: `Electronics > Phones > Smartphones`

**Как настроить:**
1. В списке категорий найдите нужную категорию
2. В поле справа введите новое название для экспорта

> **Для Google Merchant:** Используйте иерархию категорий через разделитель ` > `

---

#### Вкладка "Производитель"

##### Производители доступные для экспорта
Выберите производителей (бренды), товары которых будут включены в XML фид.

**Как выбрать:**
1. Отметьте чекбоксы нужных производителей
2. Можно выбрать несколько производителей

**Если не выбран ни один производитель:**
- В фид попадут товары всех производителей (с учетом фильтра по категориям)

**Пример использования:**
- Создание фида только для товаров Samsung и Apple
- Экспорт товаров определенного бренда на отдельную площадку

---

#### Вкладка "Атрибуты"

##### Атрибуты доступны для экспорта
Выберите атрибуты товаров, которые будут включены в XML фид.

**Примеры атрибутов:**
- Материал
- Цвет
- Размер
- Вес
- Производитель
- Страна производства

**Как выбрать:**
1. Отметьте чекбоксы нужных атрибутов
2. Атрибуты будут доступны в секции `<attributes>` XML

##### Атрибут - Гарантия
Выберите атрибут, который содержит информацию о сроке гарантии товара.

**Применение:**
- Если для товара указан этот атрибут, его значение будет использовано в теге `<warranty>`
- Если атрибут не заполнен, будет использован статический текст из общих настроек

**Примеры значений атрибута:**
- `12 месяцев`
- `24 месяца`
- `Гарантия производителя 2 года`

---

#### Вкладка "Опции"

##### Опции доступны для экспорта
Выберите опции товаров, которые будут включены в XML фид.

**Примеры опций:**
- Цвет
- Размер
- Память
- Объем

**Как выбрать:**
1. Отметьте чекбоксы нужных опций
2. Опции будут доступны в секции `<options>` XML

##### Опция размера (Google Merchant)
Выберите опцию, которая определяет размер товара.

**Применение:**
- Для Google Merchant Center в теге `<g:size>`
- Специальная обработка для товаров с размерами (одежда, обувь)

**Примеры:**
- Размер одежды (S, M, L, XL)
- Размер обуви (36, 37, 38, 39)

##### Опция цвета (Google Merchant)
Выберите опцию, которая определяет цвет товара.

**Применение:**
- Для Google Merchant Center в теге `<g:color>`
- Специальная обработка для товаров с цветовыми вариациями

**Примеры:**
- Черный
- Белый
- Красный
- Синий

---

### Сохранение фида

После настройки всех параметров нажмите кнопку **"Сохранить"** для создания фида.

Фид появится в списке на главной странице модуля.

### Редактирование фида

1. В таблице фидов нажмите кнопку **"Редактировать"** (иконка карандаша)
2. Внесите необходимые изменения
3. Нажмите **"Сохранить"**

### Удаление фида

1. В таблице фидов нажмите кнопку **"Удалить"** (иконка корзины)
2. Подтвердите удаление

> **Внимание:** XML файл из папки не удаляется автоматически, только запись в базе данных

---

## Шаблоны XML фидов

Модуль включает 5 готовых шаблонов для популярных платформ.

### Структура шаблона

Каждый шаблон состоит из 3 частей:

1. **header.twig** - Заголовок XML файла с общей информацией о магазине и категориях
2. **items.twig** - Секция товаров, генерируется для каждого пакета товаров
3. **footer.twig** - Завершающая часть XML файла

**Расположение шаблонов:**
```
catalog/view/theme/default/template/extension/feed/aw_xml_feed/layout/{template}/
```

### Доступные шаблоны

#### Google Merchant
Формат для Google Merchant Center (Google Shopping).

**Файлы:**
- `layout/google/header.twig`
- `layout/google/items.twig`
- `layout/google/footer.twig`

**Особенности:**
- Формат Atom 1.0
- Поддержка Google Product Category
- Поддержка опций размера и цвета
- GTIN коды (EAN, UPC, JAN, ISBN)

#### Facebook Product Catalog
Формат для Facebook Product Feed.

**Файлы:**
- `layout/facebook/header.twig`
- `layout/facebook/items.twig`
- `layout/facebook/footer.twig`

**Особенности:**
- Формат RSS 2.0
- Дополнительные поля для Facebook Ads
- Поддержка нескольких изображений
- Информация о наличии и доставке

#### Hotline.ua
Формат для украинской торговой площадки Hotline.

**Файлы:**
- `layout/hotline/header.twig`
- `layout/hotline/items.twig`
- `layout/hotline/footer.twig`

**Особенности:**
- Специфический формат Hotline
- Поддержка атрибутов товаров
- Информация о гарантии и доставке

#### Prom.ua
Формат для украинской торговой площадки Prom.ua.

**Файлы:**
- `layout/prom/header.twig`
- `layout/prom/items.twig`
- `layout/prom/footer.twig`

**Особенности:**
- Формат YML с расширениями Prom.ua
- Поддержка опций товаров
- Информация о наличии и доставке

#### YML
Универсальный формат для Rozetka и других площадок.

**Файлы:**
- `layout/yml/header.twig`
- `layout/yml/items.twig`
- `layout/yml/footer.twig`

**Особенности:**
- Стандарт YML
- Широкая совместимость с площадками СНГ
- Поддержка опций и атрибутов
- Информация о доставке и гарантии

### Кастомизация шаблонов

Вы можете создать собственные шаблоны или модифицировать существующие:

1. Скопируйте файлы шаблона из:
   ```
   catalog/view/theme/default/template/extension/feed/aw_xml_feed/layout/{template}/
   ```

2. В папку активной темы:
   ```
   catalog/view/theme/{ваша_тема}/template/extension/feed/aw_xml_feed/layout/{template}/
   ```

3. Внесите необходимые изменения в TWIG файлы

4. Используйте переменные из раздела [Переменные для шаблонов](#переменные-для-шаблонов)

> **Важно:** При обновлении модуля ваши кастомные шаблоны в папке темы не будут затронуты

---

## Генерация XML фидов

### Ручная генерация через браузер

#### Генерация всех активных фидов

Откройте в браузере ссылку (указана в общих настройках):

```
https://ваш-сайт.com/index.php?route=extension/feed/aw_xml_feed&access_key=ваш_ключ
```

#### Генерация конкретного фида

Добавьте параметр `feed_id`:

```
https://ваш-сайт.com/index.php?route=extension/feed/aw_xml_feed&access_key=ваш_ключ&feed_id=1
```

> **Примечание:** ID фида можно посмотреть в списке фидов (при наведении на кнопку редактирования)

### Результат генерации

После успешной генерации вы увидите страницу с результатами:

```
XML Feed Generation Results

Generated Feeds:
- Google Merchant Feed
  Template: google
  URL: https://ваш-сайт.com/xml-feed/google-feed.xml

- Facebook Catalog
  Template: facebook
  URL: https://ваш-сайт.com/xml-feed/facebook-catalog.xml
```

### Где найти сгенерированные XML файлы

XML файлы сохраняются в папке, указанной в общих настройках (по умолчанию `xml-feed`):

```
https://ваш-сайт.com/xml-feed/название-файла.xml
```

**Пример:**
```
https://ваш-сайт.com/xml-feed/google-feed.xml
https://ваш-сайт.com/xml-feed/facebook-catalog.xml
https://ваш-сайт.com/xml-feed/prom-export.xml
```

Эти ссылки используйте для загрузки фидов на торговые площадки.

---

## Автоматизация через Cron

Для автоматического обновления XML фидов настройте Cron задачу на сервере.

### Вариант 1: Генерация через CLI скрипт (рекомендуется)

#### Генерация всех активных фидов

```bash
php /path/to/your/site/cli/aw_xml_feed.php
```

#### Генерация конкретного фида

```bash
php /path/to/your/site/cli/aw_xml_feed.php 1
```

Где `1` - это ID фида.

### Вариант 2: Генерация через HTTP запрос

```bash
curl "https://ваш-сайт.com/index.php?route=extension/feed/aw_xml_feed&access_key=ваш_ключ"
```

### Настройка Cron задачи

#### Ежедневное обновление в 3:00

```cron
0 3 * * * php /home/user/public_html/cli/aw_xml_feed.php
```

#### Обновление каждые 6 часов

```cron
0 */6 * * * php /home/user/public_html/cli/aw_xml_feed.php
```

#### Обновление каждый час

```cron
0 * * * * php /home/user/public_html/cli/aw_xml_feed.php
```

### Как настроить Cron

**В cPanel:**
1. Зайдите в раздел **Cron Jobs**
2. Добавьте новую задачу
3. Укажите частоту выполнения
4. В поле команды вставьте путь к скрипту
5. Сохраните

**Через SSH:**
1. Подключитесь к серверу по SSH
2. Выполните команду: `crontab -e`
3. Добавьте строку с задачей
4. Сохраните и выйдите

> **Рекомендация:** Обновляйте фиды не чаще 1 раза в час, чтобы не создавать лишнюю нагрузку на сервер

---

## Переменные для шаблонов

При создании или модификации шаблонов XML используйте следующие переменные в формате Twig: `{{variable_name}}`

### Общие переменные (доступны в header.twig)

| Переменная | Описание | Пример значения |
|-----------|----------|-----------------|
| `{{date}}` | Дата экспорта | `2025-01-15 14:30:25` |
| `{{url}}` | URL адрес фида | `https://site.com/xml-feed/feed.xml` |
| `{{language}}` | Код языка экспорта | `ru-ru` |
| `{{currency}}` | Код валюты | `UAH` |
| `{{currency_rate}}` | Курс валюты | `1.00` |
| `{{shop_name}}` | Название магазина | `Мой Магазин` |
| `{{company_name}}` | Название компании | `ООО "Компания"` |
| `{{shop_description}}` | Описание магазина | `Интернет-магазин электроники` |
| `{{shop_country}}` | Код страны | `UA` |
| `{{show_delivery_info}}` | Выводить доставку | `true/false` |
| `{{delivery_service}}` | Служба доставки | `Новая Почта` |
| `{{delivery_days}}` | Срок доставки | `3` |
| `{{delivery_price}}` | Цена доставки | `150` |
| `{{warranty_text}}` | Текст гарантии | `12 месяцев` |

### Категории (массив categories)

Цикл по категориям:
```twig
{% for category in categories %}
    {{category.id}}
    {{category.name}}
    {{category.google_name}}
    {{category.parent_id}}
{% endfor %}
```

| Переменная | Описание |
|-----------|----------|
| `{{category.id}}` | ID категории |
| `{{category.name}}` | Название категории |
| `{{category.google_name}}` | Полный путь категории для Google |
| `{{category.parent_id}}` | ID родительской категории |

### Товары (массив offers в items.twig)

Цикл по товарам:
```twig
{% for product in offers %}
    {{product.id}}
    {{product.name}}
    {{product.price}}
{% endfor %}
```

#### Основная информация о товаре

| Переменная | Описание |
|-----------|----------|
| `{{product.id}}` | ID товара |
| `{{product.name}}` | Название товара |
| `{{product.description}}` | Описание товара |
| `{{product.model}}` | Модель товара |
| `{{product.url}}` | URL страницы товара |

#### Цены и наличие

| Переменная | Описание |
|-----------|----------|
| `{{product.price}}` | Цена товара |
| `{{product.special}}` | Акционная цена (или false) |
| `{{product.quantity}}` | Количество на складе |
| `{{product.available}}` | Доступность (true/false) |
| `{{product.in_stock}}` | В наличии (true/false) |
| `{{product.availability_status}}` | Статус наличия (`in stock`, `preorder`, `out of stock`) |
| `{{product.availability_date}}` | Дата поступления (для предзаказа) |
| `{{product.condition}}` | Состояние (`new`) |

#### Категория и производитель

| Переменная | Описание |
|-----------|----------|
| `{{product.category_id}}` | ID категории товара |
| `{{product.vendor}}` | Название производителя |
| `{{product.vendorCode}}` | Артикул/SKU |
| `{{product.google_product_category}}` | Путь категории для Google |

#### Изображения

| Переменная | Описание |
|-----------|----------|
| `{{product.image}}` | Главное изображение |
| `{{product.images}}` | Массив дополнительных изображений |

Цикл по изображениям:
```twig
{% for image in product.images %}
    {{image}}
{% endfor %}
```

#### Идентификаторы

| Переменная | Описание |
|-----------|----------|
| `{{product.gtin}}` | GTIN код (EAN, UPC, JAN или ISBN) |
| `{{product.ean}}` | EAN код |
| `{{product.upc}}` | UPC код |
| `{{product.jan}}` | JAN код |
| `{{product.isbn}}` | ISBN код |
| `{{product.mpn}}` | MPN код производителя |

#### Характеристики

| Переменная | Описание |
|-----------|----------|
| `{{product.weight}}` | Вес с единицей измерения |
| `{{product.shipping}}` | Информация о доставке |
| `{{product.warranty}}` | Информация о гарантии |

#### Атрибуты товара

Цикл по атрибутам:
```twig
{% for attribute in product.attributes %}
    {{attribute.group}}
    {{attribute.name}}
    {{attribute.value}}
{% endfor %}
```

| Переменная | Описание |
|-----------|----------|
| `{{attribute.group}}` | Группа атрибута |
| `{{attribute.name}}` | Название атрибута |
| `{{attribute.value}}` | Значение атрибута |

#### Опции товара

Цикл по опциям:
```twig
{% for option in product.options %}
    {{option.id}}
    {{option.group}}
    {{option.name}}
    {{option.price}}
    {{option.quantity}}
{% endfor %}
```

| Переменная | Описание |
|-----------|----------|
| `{{option.id}}` | ID значения опции |
| `{{option.group}}` | Название опции |
| `{{option.name}}` | Значение опции |
| `{{option.price}}` | Цена с учетом опции |
| `{{option.quantity}}` | Количество для опции |
| `{{option.weight}}` | Вес с учетом опции |

#### Специальные опции для Google

| Переменная | Описание |
|-----------|----------|
| `{{product.option_size}}` | Массив опций размера |
| `{{product.option_color}}` | Массив опций цвета |

---

## Для разработчиков

### Структура базы данных

Модуль создает таблицу `aw_xml_feed`:

```sql
CREATE TABLE IF NOT EXISTS `oc_aw_xml_feed` (
  `feed_id` INT(11) NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(256) NOT NULL,
  `filename` VARCHAR(128) NOT NULL,
  `template` TEXT NOT NULL,
  `language_id` INT(11) NOT NULL,
  `currency_code` VARCHAR(3) NOT NULL,
  `image_origin` TINYINT(1) NOT NULL,
  `image_count` INT(11) NOT NULL,
  `status` TINYINT(1) NOT NULL,
  PRIMARY KEY (`feed_id`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;
```

### Структура файлов модуля

```
xml-feed/
├── src/upload/
│   ├── admin/
│   │   ├── controller/extension/feed/aw_xml_feed.php
│   │   ├── model/extension/feed/aw_xml_feed.php
│   │   ├── language/{lang}/extension/feed/aw_xml_feed.php
│   │   └── view/template/extension/feed/
│   │       ├── aw_xml_feed.twig
│   │       └── aw_xml_feed_form.twig
│   ├── catalog/
│   │   ├── controller/extension/feed/aw_xml_feed.php
│   │   ├── model/extension/feed/aw_xml_feed.php
│   │   ├── language/{lang}/extension/feed/aw_xml_feed.php
│   │   └── view/theme/default/template/extension/feed/aw_xml_feed/
│   │       ├── result.twig
│   │       ├── result_cli.twig
│   │       └── layout/
│   │           ├── google/
│   │           ├── facebook/
│   │           ├── hotline/
│   │           ├── prom/
│   │           └── yml/
│   └── cli/
│       ├── aw_xml_feed.php
│       └── kernel.php
```

### Создание собственного шаблона

1. Создайте папку для шаблона:
   ```
   catalog/view/theme/default/template/extension/feed/aw_xml_feed/layout/custom/
   ```

2. Создайте 3 файла:
   - `header.twig` - заголовок XML
   - `items.twig` - товары
   - `footer.twig` - завершение XML

3. Добавьте шаблон в список (в контроллере):
   ```php
   $this->params['templates'] = [
       'google' => 'Google',
       'facebook' => 'Facebook',
       'custom' => 'My Custom Template',
   ];
   ```

### Программное управление фидами

#### Создание фида

```php
$this->load->model('extension/feed/aw_xml_feed');

$data = [
    'name' => 'My Feed',
    'filename' => 'my-feed',
    'template' => 'google',
    'language_id' => 1,
    'currency_code' => 'USD',
    'image_origin' => 0,
    'image_count' => 6,
    'status' => 1
];

$feedId = $this->model_extension_feed_aw_xml_feed->addFeed($data);
```

#### Получение списка фидов

```php
$this->load->model('extension/feed/aw_xml_feed');
$feeds = $this->model_extension_feed_aw_xml_feed->getFeeds();
```

#### Удаление фида

```php
$this->load->model('extension/feed/aw_xml_feed');
$this->model_extension_feed_aw_xml_feed->deleteFeed($feedId);
```

### Генерация фида программно

```php
// Генерация через контроллер
$this->request->get['access_key'] = 'ваш_ключ';
$this->request->get['feed_id'] = 1; // опционально

$controller = new ControllerExtensionFeedAwXmlFeed($registry);
$controller->index();
```

---

## Возможные ошибки и рекомендации

### Часто встречающиеся проблемы

#### Проблема 1: Ошибка 401 Unauthorized при генерации

**Причины:**
- Неверный ключ доступа в URL
- Ключ доступа не настроен в модуле

**Решение:**
1. Проверьте ключ доступа в общих настройках модуля
2. Убедитесь, что используете правильный ключ в URL
3. Скопируйте ссылку для генерации из настроек модуля

#### Проблема 2: XML файл не создается

**Причины:**
- Нет прав на запись в папку
- Папка для XML не существует
- PHP не может создать папку автоматически

**Решение:**
1. Создайте папку вручную в корне сайта (например, `xml-feed`)
2. Установите права 755 или 777 на папку:
   ```bash
   chmod 755 xml-feed
   ```
3. Проверьте, что веб-сервер имеет права на запись

#### Проблема 3: Timeout при генерации больших фидов

**Причины:**
- Слишком большой размер пакета генерации
- Много товаров в каталоге
- Ограничения PHP (max_execution_time)

**Решение:**
1. Уменьшите размер пакета в настройках до 100-250
2. Увеличьте `max_execution_time` в PHP настройках:
   ```ini
   max_execution_time = 300
   ```
3. Используйте CLI генерацию через Cron вместо HTTP

#### Проблема 4: Некорректные символы в XML

**Причины:**
- Спецсимволы в названиях или описаниях товаров
- Неправильная кодировка данных

**Решение:**
- Модуль автоматически экранирует спецсимволы
- Проверьте, что в базе данных используется UTF-8
- Убедитесь, что в названиях товаров нет недопустимых символов

#### Проблема 5: Пустой или неполный XML файл

**Причины:**
- Фильтры исключили все товары
- Товары не имеют изображений (для некоторых площадок обязательно)
- Товары отключены или не опубликованы

**Решение:**
1. Проверьте фильтры по категориям и производителям
2. Убедитесь, что товары включены и опубликованы
3. Проверьте наличие изображений у товаров
4. Временно снимите все фильтры для проверки

#### Проблема 6: Ошибка при загрузке фида на площадку

**Причины:**
- Неправильный формат XML для площадки
- Отсутствуют обязательные поля
- Неправильные значения в полях

**Решение:**
1. Проверьте XML файл валидатором площадки
2. Убедитесь, что выбран правильный шаблон
3. Проверьте требования площадки к обязательным полям
4. Для Google Merchant проверьте наличие GTIN кодов

### Рекомендации по использованию

#### Рекомендация 1: Регулярно обновляйте фиды
Настройте автоматическое обновление через Cron 1-2 раза в день для актуальности данных.

#### Рекомендация 2: Используйте разные фиды для разных площадок
Создавайте отдельные фиды с индивидуальными настройками для каждой площадки.

#### Рекомендация 3: Оптимизируйте изображения
Используйте ресайз изображений (отключите "оригиналы") для уменьшения размера фида.

#### Рекомендация 4: Заполняйте все атрибуты товаров
Чем больше информации о товаре, тем лучше он будет отображаться на площадках.

#### Рекомендация 5: Используйте GTIN коды
Для Google Merchant обязательны GTIN коды (EAN, UPC). Заполняйте их в карточках товаров.

#### Рекомендация 6: Тестируйте фиды перед публикацией
Сгенерируйте фид вручную и проверьте его валидатором площадки перед настройкой автоматизации.

#### Рекомендация 7: Мониторьте размер XML файлов
Слишком большие файлы (>50 МБ) могут не приниматься некоторыми площадками. Используйте фильтры.

#### Рекомендация 8: Используйте CLI генерацию для Cron
CLI генерация работает быстрее и стабильнее, чем HTTP запросы.

### Получение поддержки

Если вы не можете решить проблему самостоятельно:

1. **Соберите информацию:**
   - Версия OpenCart
   - Версия модуля XML Feed
   - Описание проблемы
   - Скриншоты ошибок
   - Пример XML файла (первые 50 строк)

2. **Обратитесь в поддержку:**
   - Telegram: [@alexwaha_dev](https://t.me/alexwaha_dev)
   - Email: [support@alexwaha.com](mailto:support@alexwaha.com)
   - Bug report: [https://alexwaha.com/bug-report](https://alexwaha.com/bug-report)

> **Важно:** Техническая поддержка этого модуля доступна только на платной основе. Исправление ошибок в основном репозитории выполняется без графика, по мере наличия свободного времени у разработчика.

> **Pull Request приветствуются:** Если вы можете предложить решение какой-либо проблемы, pull-request на [GitHub](https://github.com/AlexWaha/opencart-bundle/pulls) приветствуется.

---

## Лицензия и контакты

### Лицензия

Этот проект распространяется под лицензией [GNU General Public License version 3 (GPLv3)](https://github.com/alexwaha/opencart-bundle/blob/master/LICENSE).

Права и авторство данного программного обеспечения принадлежат разработчику:
**Александр Ваховский (Oleksandr Vakhovskyi)**

Также известен как:
- Alexwaha
- Ocdev.pro

Официальный сайт: [https://alexwaha.com](https://alexwaha.com)

### Условия использования

- ✓ Свободное использование в коммерческих проектах
- ✓ Модификация кода под свои нужды
- ✓ Распространение модифицированных версий (с сохранением лицензии GPLv3)
- ✗ Удаление или изменение информации об авторе

### Отказ от ответственности

Модуль протестирован на чистой установке **OpenCart** и на стандартной теме (Default).

Автор не несет ответственности за:
- Некорректную работу с темами сторонних разработчиков
- Конфликты с другими модулями
- Проблемы, возникшие в результате модификации кода модуля
- Потерю данных в результате неправильного использования

> **Рекомендация:** Всегда тестируйте модуль на тестовом сервере перед установкой на рабочем сайте.

### Платная поддержка

Настройка модуля автором, кастомизация, создание индивидуальных шаблонов, решение конфликтов с другими модулями, интеграция с площадками - только на **платной основе**.

**Услуги:**
- Установка и настройка модуля
- Создание индивидуальных XML шаблонов
- Настройка интеграции с торговыми площадками
- Решение конфликтов с другими расширениями
- Оптимизация работы модуля
- Консультации по использованию

### Контакты

**Telegram:**
[@alexwaha_dev](https://t.me/alexwaha_dev)

**Email:**
[support@alexwaha.com](mailto:support@alexwaha.com)

**Сообщить об ошибке:**
[https://alexwaha.com/bug-report](https://alexwaha.com/bug-report)

**GitHub:**
[https://github.com/AlexWaha/opencart-bundle](https://github.com/AlexWaha/opencart-bundle)

---

### Благодарности

Спасибо всем пользователям модуля за обратную связь, сообщения об ошибках и предложения по улучшению!

---

**Alexwaha.com - XML Feed для OpenCart**

---
