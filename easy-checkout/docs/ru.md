# Инструкция | Alexwaha.com - Easy Checkout

**для Opencart v2.3 - 3.x**

---

## Содержание

1. [Информация о модуле](#информация-о-модуле)
2. [Инструкция по установке](#инструкция-по-установке)
3. [Общие настройки](#общие-настройки)
4. [Конструктор страницы](#конструктор-страницы)
5. [Настройка полей покупателя](#настройка-полей-покупателя)
6. [Настройка адреса доставки](#настройка-адреса-доставки)
7. [Настройка способов доставки](#настройка-способов-доставки)
8. [Настройка способов оплаты](#настройка-способов-оплаты)
9. [Произвольные поля](#произвольные-поля)
10. [Маска телефона](#маска-телефона)
11. [JavaScript](#javascript)
12. [Импорт/Экспорт настроек](#импортэкспорт-настроек)
13. [Для разработчиков](#для-разработчиков)
14. [Возможные ошибки и рекомендации](#возможные-ошибки-и-рекомендации)
15. [Лицензия и контакты](#лицензия-и-контакты)

---

## Информация о модуле

**Easy Checkout** - это профессиональный модуль для OpenCart, который предоставляет полную замену стандартных страниц корзины и оформления заказа. Модуль предлагает упрощенный, настраиваемый процесс оформления заказа с расширенной системой конструктора страниц, которая позволяет полностью реорганизовать и настроить все элементы оформления заказа.

### Основные возможности:

- **Замена стандартного оформления заказа** - Полная замена страниц корзины и checkout
- **Конструктор страницы** - Визуальное перетаскивание блоков для создания идеального макета
- **Гибкие настройки полей** - Управление всеми полями формы (имя, телефон, адрес и т.д.)
- **Произвольные поля** - Создание неограниченного количества дополнительных полей
- **Маска телефона** - Динамическая и статическая маска для номеров телефона
- **Настройка способов доставки** - Изменение названий, добавление изображений, фильтрация по странам
- **Настройка способов оплаты** - Управление видимостью, описаниями и привязкой к способам доставки
- **Многоязычность** - Полная поддержка мультиязычности для всех настроек
- **SEO URL** - ЧПУ адреса для страницы оформления заказа
- **Импорт/Экспорт** - Резервное копирование и восстановление настроек

### Технические характеристики:

- **Автор:** Alexander Vakhovski (AlexWaha)
- **Сайт:** [https://alexwaha.com](https://alexwaha.com)
- **Лицензия:** GPLv3
- **Совместимость:** OpenCart 2.3.x - 3.x
- **Код модуля:** `aw_easy_checkout`

---

## Инструкция по установке

### Шаг 1: Предварительные требования

1. Убедитесь в том, что у Вас установлен модуль **[aw_core_oc2.3-3.x.ocmod.zip](https://github.com/AlexWaha/opencart-bundle/blob/master/Core/dist/aw_core_oc2.3_3.x.ocmod.zip)**

   > **Важно:** Это вспомогательный функционал для работы всех модулей AlexWaha

2. Для Opencart 2.3.x убедитесь, что у Вас установлен модуль, отключающий FTP-загрузку дополнений, или у Вас корректные настройки FTP в настройках магазина

   > **Примечание:** Для Opencart 3.x это не требуется

   [Ссылка на модуль отключающий FTP-загрузку (только для Opencart v2.3)](https://www.opencart.com/index.php?route=extension/extension/info&extension_id=18892)

### Шаг 2: Установка модуля

1. Установите архив **aw_easy_checkout_oc2.3-3.x.ocmod.zip** через админ-панель сайта

   - Перейдите в **Расширения → Установщик**
   - Загрузите архив модуля
   - Дождитесь завершения установки

2. Обновите кеш модификаций

   - Перейдите в **Расширения → Модификаторы**
   - Нажмите кнопку **Обновить**

3. В разделе **Расширения → Модули** найдите и включите модуль:

   **alexwaha.com - Easy Checkout**

   > **Важно:** При включении модуль автоматически установит Таблицы в БД, События и Права доступа

### Шаг 3: Самопроверка после установки

Проверьте корректность установки:

- ✓ Модуль присутствует в списке дополнений
- ✓ В разделе **Расширения → События** появились записи:
  - `aw_easy_checkout_url_rewrite`
  - `aw_easy_checkout_redirect`
- ✓ Кеш модификаций обновлен
- ✓ Страница настроек модуля открывается без ошибок

---

## Общие настройки

Перейдите в настройки модуля: **Расширения → Модули → alexwaha.com - Easy Checkout**

### Вкладка "Общие"

#### Основные параметры модуля

##### Статус модуля
- **Включено** - Модуль активен и работает
- **Отключено** - Модуль отключен, используется стандартный checkout OpenCart

##### Заменить страницу корзины
Если включено, стандартная страница корзины (`cart`) будет заменена на страницу Easy Checkout.

> **Рекомендация:** Включите эту опцию для единообразного пользовательского опыта

##### Заменить страницу оформления заказа
Если включено, стандартная страница оформления заказа (`checkout`) будет заменена на Easy Checkout.

##### SEO URL
Укажите ЧПУ адрес для страницы оформления заказа для каждого языка и магазина.

**Пример:**
- Русский: `oformlenie-zakaza`
- English: `checkout`
- Українська: `oformlennya-zamovlennya`

> **Важно:** SEO URL должен быть уникальным и не должен совпадать с существующими URL в системе

#### Настройки регистрации

Выберите режим регистрации покупателей при оформлении заказа:

- **По выбору** - Покупатель может выбрать: оформить заказ как гость или зарегистрироваться
- **Обязательна** - Покупатель должен создать учетную запись для оформления заказа
- **Без регистрации** - Только оформление как гость, без возможности регистрации

#### Настройки адресов

##### Адрес плательщика совпадает с адресом доставки
Если включено, адрес плательщика автоматически копируется из адреса доставки.

> **Рекомендация:** Включите для упрощения процесса оформления заказа

##### Показывать выбор адреса покупателя
Для авторизованных покупателей будет отображаться список сохраненных адресов для быстрого выбора.

#### Настройки макета страницы

##### Ширина колонок
Настройте распределение ширины между левой и правой колонками страницы оформления заказа.

- **Левая колонка** - Ширина в процентах (по умолчанию: 65%)
- **Правая колонка** - Ширина в процентах (по умолчанию: 35%)

##### Использовать альтернативную тему оформления
Подключить файл `theme.css` для изменения цветовой схемы модуля.

> **Путь к файлу:** `catalog/view/javascript/aw_easy_checkout/theme.css`

Этот файл позволяет легко адаптировать внешний вид оформления заказа под цвета вашего шаблона без изменения основных стилей.

#### Настройки корзины

##### Показывать вес товара
Отображать вес каждого товара в блоке корзины.

##### Показывать "Не звоните мне, я уверен в заказе"
Добавляет чекбокс, позволяющий покупателю указать, что ему не нужен звонок для подтверждения заказа.

#### Минимальная сумма заказа

Установите минимальную сумму заказа для каждой группы покупателей. Если сумма корзины меньше указанной, оформление заказа будет заблокировано.

**Настройка:**
1. Выберите группу покупателей
2. Укажите минимальную сумму
3. Сохраните настройки

> **Применение:** Полезно для оптовых покупателей или для установки минимального порога бесплатной доставки

#### Дополнительные настройки

##### Условия соглашения выбрано по умолчанию
Чекбокс согласия с условиями будет установлен автоматически при загрузке страницы.

> **Внимание:** Убедитесь, что это соответствует законодательству вашей страны

##### Почта по умолчанию
Укажите email адрес по умолчанию, если поле email не заполнено или необязательно.

**Формат:** `noreply@yourdomain.com`

---

## Конструктор страницы

### Вкладка "Конструктор страницы"

Конструктор страницы позволяет визуально управлять расположением блоков на странице оформления заказа методом перетаскивания (drag-and-drop).

### Доступные блоки

Модуль предоставляет следующие блоки для построения страницы:

| Блок | Описание | Положение по умолчанию |
|------|----------|------------------------|
| **Корзина** | Список товаров в корзине с возможностью изменения количества | Верх (левая колонка) |
| **Покупатель** | Поля информации о покупателе (имя, фамилия, телефон, email) | Верх (левая колонка) |
| **Адрес доставки** | Поля для ввода адреса доставки | Низ (левая колонка) |
| **Способ доставки** | Выбор способа доставки | Центр (левая колонка) |
| **Способ оплаты** | Выбор способа оплаты | Центр (правая колонка) |
| **Комментарий** | Поле для комментария к заказу | Низ (левая колонка) |
| **Купон** | Поле для ввода кода купона | Фиксированный блок справа |
| **Сертификат** | Поле для ввода кода подарочного сертификата | Фиксированный блок справа |
| **Итого** | Сумма заказа с разбивкой (подытог, доставка, налоги и т.д.) | Фиксированный блок справа |
| **Произвольный текст** | Пользовательский HTML контент | Во всю ширину внизу |

### Позиции для размещения блоков

#### Стандартные позиции:

- **Во всю ширину вверху** (`top_full`) - Блок растягивается на всю ширину страницы сверху
- **Верх (левая колонка)** (`top_left`) - Верхняя часть левой колонки
- **Центр (левая колонка)** (`center_left`) - Средняя часть левой колонки
- **Низ (левая колонка)** (`bottom_left`) - Нижняя часть левой колонки
- **Во всю ширину внизу** (`bottom_full`) - Блок растягивается на всю ширину страницы снизу
- **Центр (правая колонка)** (`center_right`) - Средняя часть правой колонки
- **Плавающий блок справа** (`fix_right`) - Фиксированный блок, который остается видимым при прокрутке страницы

### Как использовать конструктор

1. **Включение/отключение блоков**

   Каждый блок имеет переключатель для включения или отключения его отображения на странице.

2. **Перемещение блоков**

   - Захватите блок мышью за область заголовка
   - Перетащите его в нужную позицию
   - Отпустите для размещения
   - Блоки автоматически сортируются внутри каждой позиции

3. **Сортировка блоков**

   Внутри одной позиции можно изменять порядок отображения блоков, перетаскивая их вверх или вниз.

4. **Сохранение изменений**

   После настройки обязательно нажмите кнопку **"Сохранить"** для применения изменений.

### Примеры компоновки

#### Классический макет (по умолчанию)
```
┌────────────────────────────────┬──────────────────┐
│ Корзина                        │                  │
│ Покупатель                     │                  │
├────────────────────────────────┤ Купон            │
│ Способ доставки                │ Сертификат       │
│ Адрес доставки                 │ Итого            │
│ Комментарий                    │                  │
└────────────────────────────────┴──────────────────┘
│ Произвольный текст (полная ширина)                │
└───────────────────────────────────────────────────┘
```

#### Упрощенный макет (для B2C)
```
┌────────────────────────────────┬──────────────────┐
│ Покупатель                     │                  │
│ Адрес доставки                 │ Корзина          │
│ Способ доставки                │ Итого            │
│ Комментарий                    │                  │
└────────────────────────────────┴──────────────────┘
```

> **Совет:** Экспериментируйте с разными макетами для нахождения оптимального для вашего магазина

---

## Настройка полей покупателя

### Вкладка "Поля покупателя"

На этой вкладке вы можете настроить поля для ввода информации о покупателе.

### Стандартные поля покупателя

- **Имя** (`firstname`) - Имя покупателя
- **Фамилия** (`lastname`) - Фамилия покупателя
- **Телефон** (`telephone`) - Номер телефона
- **E-Mail** (`email`) - Адрес электронной почты

### Настройка каждого поля

Для каждого поля доступны следующие настройки:

#### Статус поля

- **Отключено** - Поле не отображается
- **Включено * [обязательный]** - Поле отображается и является обязательным для заполнения
- **Включено не обязательный** - Поле отображается, но необязательно для заполнения

#### Видимость поля

- **Отображать всем** - Поле видно всем покупателям
- **Только для гостей** - Поле видно только неавторизованным покупателям
- **Только для авторизованных** - Поле видно только авторизованным покупателям

#### Мультиязычные настройки поля

Для каждого языка можно настроить:

##### Название поля
Текст метки (label) поля, который видит покупатель.

**Пример:**
- Русский: `Имя`
- English: `First Name`
- Українська: `Ім'я`

##### Подсказка (Placeholder)
Текст-подсказка внутри пустого поля.

**Пример:**
- Русский: `Введите ваше имя`
- English: `Enter your first name`
- Українська: `Введіть ваше ім'я`

##### Текст ошибки
Сообщение, которое отобразится при неправильном заполнении поля.

**Пример:**
- Русский: `Имя должно содержать от 1 до 32 символов!`
- English: `First Name must be between 1 and 32 characters!`
- Українська: `Ім'я повинно містити від 1 до 32 символів!`

##### Регулярное выражение (для валидации)
Regex-паттерн для проверки введенных данных.

**Примеры паттернов:**

| Назначение | Паттерн | Описание |
|-----------|---------|----------|
| Только цифры | `/^\d+$/` | Только числа |
| Только буквы | `/^[a-zA-Zа-яА-ЯёЁіІїЇєЄ]+$/u` | Буквы (латиница и кириллица) |
| Буквы и цифры | `/^[a-zA-Z0-9а-яА-ЯёЁіІїЇєЄ\s_-]+$/u` | Буквы, цифры, пробелы, дефис, подчеркивание |
| Email | `/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/` | Формат email адреса |
| Телефон | `/^\+?[\d\s\-\(\)]{10,15}$/` | Телефон (10-15 символов) |

> **Примечание:** Если поле пустое, будет проверяться только то, что значение не пустое (для обязательных полей)

#### Порядок сортировки

Укажите числовое значение для определения порядка отображения полей. Поля сортируются по возрастанию.

**Пример:**
- Имя: `1`
- Фамилия: `2`
- Телефон: `3`
- Email: `4`

### Добавление произвольных полей в блок покупателя

Вы можете добавить произвольные поля в блок информации о покупателе. Для этого:

1. Перейдите на вкладку **"Произвольные поля"**
2. Создайте новое поле с расположением **"Покупатель"**
3. Вернитесь на вкладку **"Поля покупателя"**
4. Произвольное поле появится в списке полей
5. Настройте его видимость и порядок сортировки

---

## Настройка адреса доставки

### Вкладка "Адрес доставки"

На этой вкладке вы можете настроить поля для ввода адреса доставки.

### Стандартные поля адреса

- **Страна** (`country`) - Выбор страны из списка
- **Регион** (`zone_id`) - Выбор региона/области (зависит от выбранной страны)
- **Город** (`city`) - Название города
- **Адрес** (`address_1`) - Основной адрес (улица, дом, квартира)
- **Адрес 2** (`address_2`) - Дополнительный адрес
- **Индекс** (`postcode`) - Почтовый индекс
- **Компания** (`company`) - Название компании (для юридических лиц)

### Настройка полей адреса

Аналогично полям покупателя, для каждого поля адреса доступны:

#### Статус поля
- Отключено
- Включено * [обязательный]
- Включено не обязательный

#### Видимость поля
- Отображать всем
- Только для гостей
- Только для авторизованных

#### Тип поля

Некоторые поля можно изменить на другой тип ввода:

- **Ввод (Input)** - Текстовое поле для свободного ввода
- **Список (Select)** - Выпадающий список с предустановленными вариантами

##### Настройка поля типа "Список"

Если вы выбрали тип "Список", необходимо указать возможные значения:

1. Нажмите **"Добавить значение"**
2. Введите название варианта для каждого языка
3. Укажите значение по умолчанию (опционально)
4. Добавьте необходимое количество вариантов

**Пример для поля "Город":**
- Киев
- Варшава
- Алматы

#### Мультиязычные настройки

Для каждого языка настраиваются:
- Название поля
- Подсказка (Placeholder)
- Текст ошибки
- Регулярное выражение для валидации

#### Порядок сортировки

Числовое значение для определения порядка отображения полей.

**Рекомендуемый порядок:**
1. Страна
2. Регион
3. Город
4. Адрес
5. Адрес 2
6. Индекс
7. Компания

### Особенности полей "Страна" и "Регион"

#### Поле "Страна"
- Использует встроенный справочник стран OpenCart
- При выборе страны автоматически загружается список регионов
- Влияет на расчет стоимости доставки и налогов
- Изменяет маску телефона (при включенной динамической маске)

#### Поле "Регион"
- Зависит от выбранной страны
- Список регионов загружается динамически
- Обязательно для некоторых способов доставки

> **Важно:** Поля "Страна" и "Регион" должны быть включены, если вы используете способы доставки, зависящие от географии

### Добавление произвольных полей в адрес доставки

Вы можете добавить произвольные поля в блок адреса доставки:

1. Перейдите на вкладку **"Произвольные поля"**
2. Создайте новое поле с расположением **"Адрес"**
3. Вернитесь на вкладку **"Адрес доставки"**
4. Произвольное поле появится в списке
5. Настройте его параметры

**Примеры произвольных полей:**
- Код домофона
- Подъезд
- Этаж
- Время доставки
- Инструкции для курьера

---

## Настройка способов доставки

### Вкладка "Способы доставки"

На этой вкладке вы можете настроить отображение и поведение способов доставки.

### Общие настройки доставки

#### Бесплатная доставка от
Укажите сумму заказа, при достижении которой доставка становится бесплатной.

**Настройка:**
1. Включите параметр **"Бесплатная доставка от"**
2. Укажите сумму (например, `1000`)
3. На странице оформления заказа покупатель увидит сообщение:
   - **"До бесплатной доставки осталось: \$150."** (если сумма корзины \$750)
   - **"Бесплатная доставка!"** (если сумма корзины >= 1000)

> **Применение:** Стимулирует покупателей увеличить сумму заказа для получения бесплатной доставки

### Настройка отдельных способов доставки

Для каждого установленного способа доставки можно настроить:

#### Изменить название способа доставки

Замените стандартное название способа доставки на свое.

**Пример:**
- Стандартное: `Flat Rate`
- Измененное: `Доставка курьером по городу`

**Настройка:**
1. Включите **"Изменить название способа доставки"**
2. Введите новое название для каждого языка

#### Изображение способа доставки

Добавьте логотип или иконку для визуального обозначения способа доставки.

**Рекомендации:**
- Размер: 36x36 пикселей (или пропорционально больше)
- Формат: PNG с прозрачным фоном
- Содержание: Логотип службы доставки или тематическая иконка

**Настройка:**
1. Нажмите на поле изображения
2. Выберите изображение из менеджера файлов
3. Укажите ширину и высоту отображения (по умолчанию: 36x36)

#### Настройка видимости по странам

##### Отображать для всех стран
Способ доставки будет доступен покупателям из любой страны.

##### Только для выбранных стран
Способ доставки будет отображаться только покупателям из указанных стран.

**Как настроить:**
1. Выберите **"Только для выбранных стран"**
2. Начните вводить название страны в поле поиска
3. Выберите нужную страну из выпадающего списка
4. Добавьте все необходимые страны

**Пример использования:**
- Нова Пошта - только для Украины
- DHL Express - для всех стран

##### Не показывать для стран
Способ доставки будет скрыт для покупателей из указанных стран.

**Пример использования:**
- Скрыть "Самовывоз" для покупателей из других стран
- Скрыть локальную курьерскую службу для международных заказов

### Интеграция с модулями доставки

Модуль Easy Checkout автоматически интегрируется со всеми установленными расширениями доставки:

- Flat Rate (Фиксированная стоимость)
- Weight Based Shipping (По весу)
- Free Shipping (Бесплатная доставка)
- PickPoint
- Новая Почта
- Укрпочта
- Boxberry
- И другие сторонние модули доставки

> **Важно:** Для отображения способов доставки в блоке Easy Checkout, они должны быть установлены, настроены и включены в стандартном разделе **Расширения → Доставка**

### Сообщения о доставке

#### Доставка доступна
Если выбраны страна и регион, для которых настроены способы доставки, покупатель увидит доступные варианты.

#### Нет доступных способов доставки
Если способы доставки недоступны (неправильная география, превышен вес и т.д.), отобразится сообщение:

**"Нет доступных способов доставки."**

> **Совет:** Настройте хотя бы один универсальный способ доставки (например, "Доставка курьером") для всех стран

---

## Настройка способов оплаты

### Вкладка "Способы оплаты"

На этой вкладке вы можете настроить отображение и поведение способов оплаты.

### Настройка отдельных способов оплаты

Для каждого установленного способа оплаты доступны следующие настройки:

#### Изменить название способа оплаты

Замените стандартное название способа оплаты на свое.

**Пример:**
- Стандартное: `Cash On Delivery`
- Измененное: `Оплата наличными при получении`

**Настройка:**
1. Включите **"Изменить название способа оплаты"**
2. Введите новое название для каждого языка

#### Описание способа оплаты

Добавьте описание, которое будет отображаться под выбранным способом оплаты.

**Пример:**
```
Оплата производится курьеру при получении заказа.
Принимаются наличные и банковские карты.
```

**Настройка:**
1. Включите **"Выводить описание под способом оплаты"**
2. Введите текст описания для каждого языка

#### Изображение способа оплаты

Добавьте логотип или иконку платежной системы.

**Рекомендации:**
- Размер: 36x36 пикселей (или пропорционально)
- Формат: PNG с прозрачным фоном
- Содержание: Логотип платежной системы (Visa, MasterCard, PayPal и т.д.)

**Настройка:**
1. Нажмите на поле изображения
2. Выберите изображение из менеджера файлов
3. Укажите ширину и высоту отображения

#### Настройка видимости по типу пользователя

##### Вариант доступен гостям
Способ оплаты будет отображаться неавторизованным покупателям.

##### Вариант доступен авторизованным пользователям
Способ оплаты будет отображаться авторизованным покупателям.

**Примеры использования:**

| Способ оплаты | Гости | Авторизованные | Причина |
|--------------|-------|----------------|---------|
| Наличные при получении | ✓ | ✓ | Доступен всем |
| Банковский перевод | ✗ | ✓ | Требуется реквизиты клиента |
| Оплата бонусами | ✗ | ✓ | Бонусы есть только у зарегистрированных |
| Оплата картой онлайн | ✓ | ✓ | Доступен всем |

#### Ограничение по способам доставки

Укажите, для каких способов доставки доступен данный способ оплаты.

**Настройка:**
1. Выберите способы доставки из списка
2. Способ оплаты будет доступен только при выборе указанных способов доставки
3. Если ничего не выбрано, способ оплаты доступен для всех способов доставки

**Примеры ограничений:**

| Способ оплаты | Доступен для доставки | Причина |
|--------------|----------------------|---------|
| Наличные при получении | Курьерская доставка, Почта наложенным платежом | Нельзя оплатить наличными при самовывозе из пункта |
| Оплата в офисе | Самовывоз | Оплата производится при получении товара в офисе |
| Предоплата 100% | Доставка в другую страну | Международная доставка требует предоплаты |

> **Совет:** Используйте ограничения для автоматической фильтрации несовместимых комбинаций доставки и оплаты

### Интеграция с модулями оплаты

Модуль Easy Checkout автоматически интегрируется со всеми установленными расширениями оплаты:

- Cash On Delivery (Наличные при доставке)
- Bank Transfer (Банковский перевод)
- PayPal
- Stripe
- LiqPay
- WayForPay
- И другие сторонние модули оплаты

> **Важно:** Для отображения способов оплаты в блоке Easy Checkout, они должны быть установлены, настроены и включены в стандартном разделе **Расширения → Оплата**

### Сообщения об оплате

#### Нет доступных способов оплаты
Если все способы оплаты скрыты фильтрами (гость/авторизация, способ доставки), отобразится сообщение:

**"Нет доступных способов оплаты"**

> **Рекомендация:** Настройте хотя бы один универсальный способ оплаты, доступный для всех типов пользователей и способов доставки

---

## Произвольные поля

### Вкладка "Произвольные поля"

Произвольные поля позволяют собирать дополнительную информацию от покупателей, которая не входит в стандартный набор полей OpenCart.

### Список произвольных полей

В таблице отображаются все созданные произвольные поля с информацией:

| Колонка | Описание |
|---------|----------|
| **Название** | Название поля (на языке по умолчанию) |
| **Расположение** | Где отображается поле (Покупатель / Адрес) |
| **Тип поля** | Тип поля (Select, Input, Textarea и т.д.) |
| **Статус** | Включено / Отключено |
| **Действие** | Редактировать / Удалить |

### Создание нового произвольного поля

Нажмите кнопку **"Создать поле"** для открытия формы создания.

#### Шаг 1: Основные настройки

##### Расположение
Выберите, где будет отображаться поле:

- **Покупатель** - В блоке информации о покупателе
- **Адрес** - В блоке адреса доставки

##### Тип поля
Выберите тип поля из списка:

**Поля выбора (требуют указания вариантов):**
- **Список (Select)** - Стандартный выпадающий список
- **Список (Select2)** - Улучшенный выпадающий список с поиском
- **Переключатель (Radio)** - Группа переключателей (выбор одного из нескольких)
- **Флажок (Checkbox)** - Группа чекбоксов (выбор нескольких вариантов)

**Поля ввода:**
- **Ввод (Input)** - Однострочное текстовое поле
- **Текстовая строка (Text)** - Однострочное текстовое поле (аналог Input)
- **Текстовое поле (Textarea)** - Многострочное текстовое поле
- **Дата** - Календарь для выбора даты (формат: ГГГГ-ММ-ДД)
- **Дата и время** - Календарь с временем (формат: ГГГГ-ММ-ДД ЧЧ:ММ)
- **Время** - Выбор времени (формат: ЧЧ:ММ)

##### Статус
- **Включено** - Поле активно и отображается
- **Отключено** - Поле скрыто

##### Обязательно
- **Да** - Поле обязательно для заполнения
- **Нет** - Поле необязательное

##### Сохранять значение поля в комментарий к заказу
- **Да** - Значение поля будет добавлено в комментарий заказа в админ-панели
- **Нет** - Значение сохраняется только в базе данных

> **Рекомендация:** Включите эту опцию для важной информации, которую нужно видеть сразу при просмотре заказа

#### Шаг 2: Названия и сообщения (мультиязычные)

Для каждого языка укажите:

##### Название поля
Текст метки (label), который видит покупатель.

**Пример:**
- Русский: `Код домофона`
- English: `Intercom code`

##### Подсказка (Placeholder)
Текст-подсказка внутри пустого поля (для полей ввода).

**Пример:**
- Русский: `Например: 123К456`
- English: `Example: 123K456`

##### Текст ошибки
Сообщение при неправильном заполнении или незаполненном обязательном поле.

**Пример:**
- Русский: `Пожалуйста, укажите код домофона`
- English: `Please enter the intercom code`

#### Шаг 3: Проверка (Validation)

##### Регулярное выражение
Укажите regex-паттерн для проверки введенных данных.

**Распространенные шаблоны:**

| Назначение | Паттерн | Пример значения      |
|-----------|---------|----------------------|
| Только цифры | `/^\d+$/` | `12345`              |
| Только буквы | `/^[a-zA-Zа-яА-ЯёЁіІїЇєЄ]+$/u` | `Иванов`             |
| Буквы и цифры | `/^[a-zA-Z0-9а-яА-ЯёЁіІїЇєЄ\s_-]+$/u` | `Квартира 5`         |
| Email | `/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/` | `user@example.com`   |
| Телефон (10-15 цифр) | `/^\+?[\d\s\-\(\)]{10,15}$/` | `+3 (999) 123-45-67` |

> **Примечание:** Если поле пустое, проверяется только обязательность заполнения

**Быстрый выбор паттерна:**
В форме есть выпадающий список с распространенными паттернами. Выберите нужный, и он автоматически подставится в поле.

#### Шаг 4: Значения (для Select, Radio, Checkbox)

Если вы выбрали тип поля **Select**, **Select2**, **Radio** или **Checkbox**, необходимо указать возможные варианты выбора.

##### Добавление значения

1. Нажмите кнопку **"Добавить значение"**
2. Для каждого языка введите название варианта
3. Укажите порядок сортировки (числовое значение)
4. Повторите для всех вариантов

**Пример для поля "Время доставки":**

| Значение (RU) | Значение (EN) | Сортировка |
|--------------|---------------|------------|
| Утро (9:00 - 12:00) | Morning (9:00 AM - 12:00 PM) | 1 |
| День (12:00 - 18:00) | Afternoon (12:00 PM - 6:00 PM) | 2 |
| Вечер (18:00 - 21:00) | Evening (6:00 PM - 9:00 PM) | 3 |

##### Значение по умолчанию
Для полей типа Select можно указать значение, которое будет выбрано автоматически при загрузке страницы.

#### Шаг 5: Группы покупателей

Укажите, для каких групп покупателей будет отображаться это поле.

**Настройка:**
1. Отметьте нужные группы покупателей (Default, Wholesale, Retailer и т.д.)
2. Если ничего не отмечено, поле будет доступно всем группам

**Пример использования:**
- Поле "ИНН компании" - только для группы "Оптовые покупатели"
- Поле "Номер дисконтной карты" - только для группы "VIP клиенты"

#### Сохранение поля

Нажмите кнопку **"Сохранить"** для создания поля. Поле появится в списке произвольных полей и станет доступно для добавления в блоки "Покупатель" или "Адрес доставки".

### Редактирование произвольного поля

1. В таблице произвольных полей нажмите кнопку **"Редактировать"** (иконка карандаша)
2. Внесите необходимые изменения
3. Нажмите **"Сохранить"**

> **Внимание:** Изменение расположения поля (Покупатель/Адрес) недоступно, если поле уже используется в конфигурации блоков

### Удаление произвольного поля

1. В таблице произвольных полей нажмите кнопку **"Удалить"** (иконка корзины)
2. Подтвердите удаление

### Примеры использования произвольных полей

#### Пример 1: Код домофона
- **Тип:** Input
- **Расположение:** Адрес
- **Обязательно:** Нет
- **Сохранять в комментарий:** Да
- **Validation:** `/^\d+[А-Яа-я]?\d*$/u` (цифры и опционально буква)

#### Пример 2: Желаемая дата доставки
- **Тип:** Дата
- **Расположение:** Адрес
- **Обязательно:** Да
- **Сохранять в комментарий:** Да

#### Пример 3: Время доставки
- **Тип:** Select
- **Расположение:** Адрес
- **Обязательно:** Да
- **Значения:**
  - Утро (9:00 - 13:00)
  - День (13:00 - 18:00)
  - Вечер (18:00 - 22:00)
- **Сохранять в комментарий:** Да

#### Пример 4: Особые пожелания
- **Тип:** Textarea
- **Расположение:** Адрес
- **Обязательно:** Нет
- **Сохранять в комментарий:** Да

#### Пример 5: Тип упаковки
- **Тип:** Radio
- **Расположение:** Покупатель
- **Обязательно:** Нет
- **Значения:**
  - Стандартная упаковка (бесплатно)
  - Подарочная упаковка (+\$20.)
  - Премиум упаковка (+\$50.)

---

## Маска телефона

### Функциональность маски телефона

Модуль Easy Checkout включает продвинутую систему форматирования номеров телефонов с поддержкой как статических, так и динамических масок.

### Типы масок телефона

#### Отключено
Маска не применяется. Пользователь может вводить номер в любом формате.

> **Не рекомендуется:** Может привести к некорректным номерам телефонов в заказах

#### Статическая маска
Используется единая маска для всех стран, указанная в настройках модуля.

**Когда использовать:**
- Вы работаете только с одной страной
- У вас специфический формат телефона
- Вы хотите полный контроль над форматом

**Настройка:**
1. Выберите тип маски: **"Статическая маска (только из настроек)"**
2. Укажите маску в поле **"Маска телефона для Maska.js"**

**Пример маски для Украины:**
```
+3 (###) ###-##-##
```

#### Динамическая маска (рекомендуется)
Маска автоматически изменяется в зависимости от выбранной страны в адресе доставки.

**Преимущества:**
- Автоматическая адаптация под формат страны
- Удобство для международных покупателей
- База масок для 100+ стран

**Настройка:**
1. Выберите тип маски: **"Динамическая маска (автоматически по стране)"**
2. Укажите резервную маску для стран без поддержки

**Как работает:**
1. Покупатель выбирает страну в поле "Страна"
2. Модуль автоматически определяет маску для этой страны из встроенной базы
3. Поле телефона переключается на соответствующую маску
4. Если маска для страны не найдена, используется резервная маска

### Формат маски для Maska.js

Модуль использует библиотеку **Maska.js** для форматирования телефонов. Маска задается с помощью специальных токенов:

| Токен | Описание | Пример |
|-------|----------|--------|
| `#` | Цифра (0-9) | `###` → `123` |
| `@` | Буква (a-z, A-Z) | `@@@` → `abc` |
| `*` | Буква или цифра | `***` → `a1b` |

**Примеры масок для разных стран:**

| Страна | Маска | Формат результата |
|--------|-------|-------------------|
| Украина | `+38 (0##) ###-##-##` | `+38 (099) 123-45-67` |
| США/Канада | `+1 (###) ###-####` | `+1 (555) 123-4567` |
| Великобритания | `+44 ## #### ####` | `+44 20 1234 5678` |
| Германия | `+49 ### ########` | `+49 123 45678901` |
| Казахстан | `+7 (7##) ###-##-##` | `+7 (777) 123-45-67` |

### База данных масок стран

Модуль включает встроенный файл `country_phone_masks.json` с масками для 100+ стран.

**Расположение файла:**
```
system/library/Alexwaha/fixtures/country_phone_masks.json
```

**Структура записи:**
```json
{
  "RU": {
    "name": "USA",
    "dial_code": "+1",
    "mask": "+1 (###) ###-##-##"
  },
  "UA": {
    "name": "Ukraine",
    "dial_code": "+380",
    "mask": "+38 (0##) ###-##-##"
  }
}
```

> **Для разработчиков:** Вы можете добавить или изменить маски в этом файле при необходимости

### Резервная маска

Резервная маска используется для стран, которые отсутствуют в базе данных масок.

**Рекомендуемая резервная маска:**
```
+###############
```

Эта маска позволяет ввести любой международный номер телефона (до 15 цифр с кодом страны).

### Настройка маски телефона

1. Перейдите в настройки модуля, вкладка **"Общие"**
2. Найдите раздел **"Маска телефона"**
3. Выберите тип маски:
   - Отключено
   - Статическая маска
   - Динамическая маска (рекомендуется)
4. Укажите маску (для статической) или резервную маску (для динамической)
5. Сохраните настройки

### Проверка работы маски

1. Откройте страницу оформления заказа на фронтенде
2. Начните вводить номер телефона в поле "Телефон"
3. Убедитесь, что формат автоматически применяется
4. Для динамической маски: измените страну и проверьте изменение формата

### Советы по использованию

**Для магазинов в одной стране:**
- Используйте статическую маску с форматом вашей страны
- Это упростит настройку и обеспечит единообразие

**Для международных магазинов:**
- Используйте динамическую маску
- Установите универсальную резервную маску
- Поле "Страна" должно быть обязательным для корректной работы динамической маски

**Для B2B магазинов:**
- Добавьте дополнительное поле "Добавочный номер" как произвольное поле
- Используйте статическую маску для основного телефона

---

## JavaScript

### Вкладка "Javascript"

На этой вкладке вы можете добавить пользовательский JavaScript код, который будет выполняться после обновления блоков на странице оформления заказа.

### Когда использовать

Используйте эту функцию для:

- **Интеграции с аналитикой** - Отправка событий в Google Analytics, Facebook и т.д.
- **Дополнительной валидации** - Проверка данных на стороне клиента
- **Изменения поведения элементов** - Скрытие/показ блоков в зависимости от условий
- **Интеграции с чатами** - Передача данных в онлайн-чат
- **Кастомизации интерфейса** - Изменение внешнего вида элементов

### Синтаксис и доступные переменные

JavaScript код выполняется после каждого обновления блоков checkout страницы.

**Доступные библиотеки:**
- jQuery (алиас `$`)
- Все глобальные переменные `window`

**Контекст выполнения:**
Код выполняется в глобальной области видимости, имеет доступ к DOM и всем элементам страницы.

### Примеры использования

#### Пример 1: Отправка события в Google Analytics

```javascript
// Отправка события при достижении страницы оформления заказа
if (typeof gtag !== 'undefined') {
    gtag('event', 'begin_checkout', {
        'event_category': 'ecommerce',
        'event_label': 'Easy Checkout Page'
    });
}
```

#### Пример 2: Скрытие блока купона для определенной группы

```javascript
// Скрыть блок купона для гостей
$(document).ready(function() {
    var isGuest = $('input[name="account"]:checked').val() === 'guest';
    if (isGuest) {
        $('.coupon-block').hide();
    }
});
```

#### Пример 3: Автозаполнение поля при выборе определенной страны

```javascript
// Автоматически заполнить индекс для Киева
$('select[name="country_id"]').on('change', function() {
    var countryId = $(this).val();
    var cityName = $('input[name="city"]').val().toLowerCase();

    if (countryId == '220' && cityName.includes('Киев')) {
        $('input[name="postcode"]').val('01001');
    }
});
```

#### Пример 4: Валидация ИНН для юридических лиц

```javascript
// Проверка ИНН (10 или 12 цифр для Украины)
$('input[name="custom_field[123]"]').on('blur', function() {
    var inn = $(this).val().replace(/\D/g, '');
    var isValid = inn.length === 10 || inn.length === 12;

    if (!isValid && inn.length > 0) {
        alert('ИНН должен содержать 10 или 12 цифр');
        $(this).addClass('error');
    } else {
        $(this).removeClass('error');
    }
});
```

#### Пример 5: Отображение предупреждения при выборе определенного способа оплаты

```javascript
// Предупреждение при выборе наложенного платежа
$('input[name="payment_method"]').on('change', function() {
    var paymentCode = $(this).val();

    if (paymentCode === 'cod') {
        var message = 'Внимание! При оплате наложенным платежом взимается дополнительная комиссия 3%.';
        if (!$('.cod-warning').length) {
            $(this).closest('.radio').append('<div class="cod-warning alert alert-warning">' + message + '</div>');
        }
    } else {
        $('.cod-warning').remove();
    }
});
```

### Отладка JavaScript кода

Для отладки используйте консоль браузера:

1. Откройте страницу оформления заказа
2. Нажмите `F12` для открытия консоли разработчика
3. Перейдите на вкладку **Console**
4. Проверьте наличие ошибок
5. Используйте `console.log()` для вывода отладочной информации

**Пример отладки:**
```javascript
console.log('Easy Checkout JavaScript loaded');

$('input[name="telephone"]').on('change', function() {
    console.log('Phone number changed:', $(this).val());
});
```

### Важные замечания

> **Внимание:** Некорректный JavaScript код может нарушить работу страницы оформления заказа. Тщательно тестируйте код перед использованием на рабочем сайте.

> **Безопасность:** Не используйте код из непроверенных источников. Вредоносный JavaScript может украсть данные покупателей.

> **Производительность:** Избегайте тяжелых операций и длинных циклов, которые могут замедлить загрузку страницы.

> **Совместимость:** Используйте jQuery синтаксис для совместимости с различными темами OpenCart.

---

## Импорт/Экспорт настроек

### Вкладка "Импорт/Экспорт"

Функция импорта и экспорта позволяет сохранять резервные копии настроек модуля и переносить их между магазинами.

### Экспорт настроек

Экспорт создает JSON файл со всеми текущими настройками модуля.

#### Что включает экспорт:

- ✓ Общие настройки (статус, замена страниц, регистрация)
- ✓ Настройки макета (ширина колонок, использование theme.css)
- ✓ Конфигурация блоков (позиции, сортировка, статус)
- ✓ Настройки полей покупателя
- ✓ Настройки полей адреса доставки
- ✓ Настройки способов доставки
- ✓ Настройки способов оплаты
- ✓ Схема произвольных полей (структура, не данные)
- ✓ JavaScript код
- ✓ Произвольный текст
- ✓ SEO URL для всех языков и магазинов
- ✓ Настройки телефонной маски
- ✓ Минимальные суммы заказа

#### Как экспортировать настройки:

1. Перейдите на вкладку **"Импорт/Экспорт"**
2. Нажмите кнопку **"Экспортировать"**
3. Файл будет автоматически загружен в браузер

**Имя файла:** `aw_easy_checkout_settings_YYYY-MM-DD_HH-ii-ss.json`

**Пример:** `aw_easy_checkout_settings_2025-01-15_14-30-25.json`

#### Когда использовать экспорт:

- **Перед импортом новых настроек** - Создайте резервную копию текущих настроек
- **Перед обновлением модуля** - Сохраните настройки на случай необходимости отката
- **Перенос на тестовый сервер** - Скопируйте настройки с рабочего сайта на тестовый
- **Клонирование магазина** - Перенесите настройки в новый магазин
- **Периодические бэкапы** - Регулярно сохраняйте копии для безопасности

### Импорт настроек

Импорт загружает настройки из ранее экспортированного JSON файла.

> **Внимание!** Импорт настроек **заменит ВСЕ** текущие настройки модуля. Перед импортом обязательно сделайте экспорт текущих настроек!

#### Как импортировать настройки:

1. Перейдите на вкладку **"Импорт/Экспорт"**
2. Нажмите кнопку **"Выберите файл"**
3. Выберите ранее экспортированный JSON файл
4. Нажмите кнопку **"Импортировать"**
5. Дождитесь сообщения об успешном импорте
6. Обновите страницу настроек для применения изменений

#### Проверка после импорта:

После успешного импорта проверьте:

- ✓ Вкладка "Общие" - все настройки корректны
- ✓ Вкладка "Конструктор страницы" - блоки на своих местах
- ✓ Вкладка "Поля покупателя" - поля настроены правильно
- ✓ Вкладка "Адрес доставки" - поля адреса корректны
- ✓ Вкладка "Способы доставки" - настройки применены
- ✓ Вкладка "Способы оплаты" - настройки применены
- ✓ Вкладка "Произвольные поля" - поля импортированы
- ✓ Фронтенд сайта - страница checkout отображается корректно

#### Возможные ошибки при импорте:

##### "Пожалуйста, выберите файл для импорта!"
- Вы не выбрали файл перед нажатием кнопки "Импортировать"
- **Решение:** Выберите JSON файл и повторите попытку

##### "Неверный формат файла. Ожидается JSON файл с настройками модуля."
- Файл поврежден или имеет неверный формат
- Файл не является экспортом настроек Easy Checkout
- **Решение:** Убедитесь, что используете правильный файл экспорта

##### "Ошибка при импорте настроек: [описание ошибки]"
- Произошла техническая ошибка при обработке файла
- **Решение:** Проверьте логи сервера, свяжитесь с поддержкой

##### "У Вас нет прав для управления данным модулем!"
- У вашей учетной записи нет прав на изменение настроек модуля
- **Решение:** Войдите под учетной записью администратора или получите необходимые права

### Структура экспортируемого файла

JSON файл имеет следующую структуру (упрощенно):

```json
{
  "status": true,
  "replace_cart": true,
  "replace_checkout": true,
  "customer": {
    "default": {
      "title": "Default",
      "firstname": { ... },
      "lastname": { ... },
      "telephone": { ... },
      "email": { ... }
    }
  },
  "shipping_address": { ... },
  "shipping_methods": { ... },
  "payment_methods": { ... },
  "block_status": { ... },
  "block_position": { ... },
  "block_sort_order": { ... },
  "mask_type": "dynamic",
  "mask": "",
  "javascript": "",
  "seo_url": { ... }
}
```

> **Для разработчиков:** Вы можете вручную редактировать JSON файл в текстовом редакторе перед импортом (на свой страх и риск)

### Перенос настроек между магазинами

#### Сценарий 1: Копирование с рабочего на тестовый сервер

1. На рабочем сервере: экспортируйте настройки
2. Скачайте JSON файл
3. На тестовом сервере: установите модуль Easy Checkout
4. Импортируйте скачанный JSON файл
5. Проверьте корректность настроек

#### Сценарий 2: Клонирование настроек в новый магазин

1. В исходном магазине: экспортируйте настройки
2. В новом магазине: установите модуль Easy Checkout
3. Установите те же способы доставки и оплаты, что и в исходном магазине
4. Импортируйте файл настроек
5. Адаптируйте настройки под новый магазин (SEO URL, email по умолчанию и т.д.)

#### Сценарий 3: Откат к предыдущей версии настроек

1. Найдите резервную копию настроек (экспортированный ранее JSON файл)
2. В текущем магазине: импортируйте файл резервной копии
3. Проверьте восстановление настроек

---

## Для разработчиков

### Интеграция с кодом

Модуль Easy Checkout предоставляет API для интеграции с пользовательским кодом и расширениями.

### Структура файлов модуля

```
easy-checkout/
├── admin/
│   ├── controller/extension/module/aw_easy_checkout.php
│   ├── model/extension/module/aw_easy_checkout.php
│   ├── language/{lang}/extension/module/aw_easy_checkout.php
│   └── view/template/extension/module/aw_easy_checkout/
├── catalog/
│   ├── controller/extension/aw_easy_checkout/
│   │   ├── main.php - Основной контроллер страницы
│   │   ├── customer.php - Обработка полей покупателя
│   │   ├── address.php - Обработка адреса
│   │   ├── shipping_method.php - Способы доставки
│   │   ├── payment_method.php - Способы оплаты
│   │   ├── cart.php - Корзина
│   │   ├── comment.php - Комментарий к заказу
│   │   ├── coupon_voucher.php - Купоны и сертификаты
│   │   ├── custom_text.php - Произвольный текст
│   │   ├── validation.php - Серверная валидация
│   │   ├── reload.php - AJAX обновление блоков
│   │   ├── api.php - API эндпоинты
│   │   ├── country.php - Получение регионов по стране
│   │   └── event.php - Обработчики событий
│   ├── model/extension/aw_easy_checkout/model.php
│   ├── language/{lang}/extension/aw_easy_checkout/lang.php
│   └── view/template/extension/aw_easy_checkout/
└── system/library/Alexwaha/
    ├── EasyCheckoutHelper.php - Вспомогательный класс
    └── fixtures/country_phone_masks.json - База масок телефонов
```

### API Endpoints

Модуль предоставляет следующие AJAX endpoints для интеграции:

#### Получение способов доставки
```php
URL: index.php?route=extension/aw_easy_checkout/shipping_method
Method: POST
Response: JSON с доступными способами доставки
```

#### Получение способов оплаты
```php
URL: index.php?route=extension/aw_easy_checkout/payment_method
Method: POST
Response: JSON с доступными способами оплаты
```

#### Валидация формы
```php
URL: index.php?route=extension/aw_easy_checkout/validation
Method: POST
Response: JSON с результатами валидации
```

#### Обновление блоков
```php
URL: index.php?route=extension/aw_easy_checkout/reload
Method: POST
Parameters: block (название блока для обновления)
Response: HTML разметка блока
```

#### Получение регионов по стране
```php
URL: index.php?route=extension/aw_easy_checkout/country/zones
Method: POST
Parameters: country_id
Response: JSON со списком регионов
```

### Переопределение шаблонов

Вы можете переопределить любой шаблон модуля, создав файл в директории вашей темы:

**Структура для переопределения:**
```
catalog/view/theme/{ваша_тема}/template/extension/aw_easy_checkout/
```

**Пример переопределения шаблона корзины:**

1. Скопируйте файл:
   ```
   catalog/view/template/extension/aw_easy_checkout/cart.twig
   ```

2. В новое место:
   ```
   catalog/view/theme/mytheme/template/extension/aw_easy_checkout/cart.twig
   ```

3. Внесите необходимые изменения в скопированный файл

> **Важно:** При обновлении модуля ваши переопределенные шаблоны не будут затронуты

### Хелпер класс

Модуль предоставляет хелпер класс для упрощения работы с данными:

```php
// Загрузка хелпера
$helper = new \Alexwaha\EasyCheckoutHelper($registry);

// Получение конфигурации модуля
$config = $this->awCore->getConfig('aw_easy_checkout');
$status = $config->get('status', false);

// Получение маски телефона для страны
$mask = $helper->getPhoneMaskByCountry('UA');
// Вернет: +3 (###) ###-##-##
```

### События (Events)

Модуль регистрирует следующие события:

#### aw_easy_checkout_url_rewrite
Перехватывает все запросы на каталог для редиректа cart/checkout.

**Триггер:** `catalog/controller/*/after`
**Action:** `extension/aw_easy_checkout/event`

#### aw_easy_checkout_redirect
Обрабатывает редиректы со стандартных страниц cart/checkout на Easy Checkout.

**Триггер:** `catalog/controller/*/before`
**Action:** `extension/aw_easy_checkout/event/redirect`

### Добавление произвольного блока

Для добавления собственного блока в систему:

1. Создайте контроллер:
   ```php
   // catalog/controller/extension/aw_easy_checkout/my_custom_block.php

   class ControllerExtensionAwEasyCheckoutMyCustomBlock extends Controller {
       public function index() {
           $data = [];

           // Ваша логика
           $data['custom_data'] = 'Hello World';

           return $this->load->view('extension/aw_easy_checkout/my_custom_block', $data);
       }
   }
   ```

2. Создайте шаблон:
   ```twig
   {# catalog/view/template/extension/aw_easy_checkout/my_custom_block.twig #}

   <div class="my-custom-block">
       <h3>My Custom Block</h3>
       <p>{{ custom_data }}</p>
   </div>
   ```

3. Добавьте блок в конфигурацию через хук или напрямую в базу данных

### Работа с произвольными полями из кода

#### Получение значения произвольного поля в заказе

```php
// В контроллере или модели
$this->load->model('extension/module/aw_easy_checkout');

$customFieldId = 123; // ID вашего произвольного поля
$orderId = 456; // ID заказа

// Получение информации о произвольном поле
$customField = $this->model_extension_module_aw_easy_checkout->getCustomField($customFieldId);

// Получение значения из сессии (при оформлении заказа)
$value = $this->session->data['custom_field'][$customFieldId] ?? '';

// Получение из данных заказа
$this->load->model('checkout/order');
$order = $this->model_checkout_order->getOrder($orderId);
$customFieldsData = json_decode($order['custom_field'], true);
$value = $customFieldsData[$customFieldId] ?? '';
```

#### Программное создание произвольного поля

```php
$this->load->model('extension/module/aw_easy_checkout');

$data = [
    'type' => 'text',
    'location' => 'customer',
    'status' => 1,
    'required' => 1,
    'save_to_order' => 1,
    'validation' => '/^\d+$/',
    'custom_field_description' => [
        'name' => [
            1 => 'Customer Code', // language_id => name
            2 => 'Код клиента'
        ],
        'text_error' => [
            1 => 'Please enter customer code',
            2 => 'Пожалуйста, введите код клиента'
        ]
    ],
    'custom_field_customer_group' => [
        ['customer_group_id' => 1]
    ]
];

$customFieldId = $this->model_extension_module_aw_easy_checkout->addCustomField($data);
```

### Подключение к обработке заказа

Если вам нужно выполнить действия при оформлении заказа через Easy Checkout:

```php
// Создайте событие
$this->load->model('setting/event');

$this->model_setting_event->addEvent(
    'my_extension_easy_checkout',
    'catalog/model/checkout/order/addOrder/before',
    'extension/my_extension/event/beforeOrderAdd'
);

// Обработчик события
// catalog/controller/extension/my_extension/event.php

public function beforeOrderAdd(&$route, &$args) {
    // $args[0] содержит данные заказа
    $orderData = &$args[0];

    // Проверяем, что заказ оформляется через Easy Checkout
    if (isset($this->session->data['easy_checkout'])) {
        // Ваша логика
        $this->log->write('Order placed via Easy Checkout');
    }
}
```

### Получение конфигурации модуля

```php
// Через awCore helper
$config = $this->awCore->getConfig('aw_easy_checkout');

// Получение конкретных значений
$replaceCart = $config->get('replace_cart', false);
$replaceCheckout = $config->get('replace_checkout', false);
$maskType = $config->get('mask_type', 'dynamic');
$customerFields = $config->get('customer', []);

// Получение блоков
$blockStatus = $config->get('block_status', []);
$blockPosition = $config->get('block_position', []);
```

### Программное изменение настроек

```php
// Изменение настроек модуля программно
$this->load->model('setting/setting');

$settings = [
    'aw_easy_checkout_status' => 1,
    'aw_easy_checkout_replace_cart' => 1,
    'aw_easy_checkout_replace_checkout' => 1,
    // ... другие настройки
];

// Для основного магазина (store_id = 0)
$this->model_setting_setting->editSetting('aw_easy_checkout', $settings, 0);

// Для конкретного магазина
$this->model_setting_setting->editSetting('aw_easy_checkout', $settings, $store_id);
```

### Отладка

#### Включение логирования

Добавьте логирование в вашем коде:

```php
// В контроллере Easy Checkout
$this->log->write('Easy Checkout Debug: ' . json_encode($data));
```

Логи сохраняются в: `system/storage/logs/error.log`

#### Просмотр данных сессии

```php
// Вывод всех данных Easy Checkout из сессии
echo '<pre>';
print_r($this->session->data);
echo '</pre>';
exit;
```

#### Проверка загруженных способов доставки

```php
$this->load->controller('extension/aw_easy_checkout/shipping_method');
echo '<pre>';
print_r($this->session->data['shipping_methods']);
echo '</pre>';
```

---

## Возможные ошибки и рекомендации

### Часто встречающиеся проблемы

#### Проблема 1: Страница checkout не открывается (ошибка 404)

**Причины:**
- События модуля не установлены
- Кеш модификаций не обновлен
- SEO URL настроен некорректно

**Решение:**
1. Проверьте наличие событий в **Расширения → События**:
   - `aw_easy_checkout_url_rewrite`
   - `aw_easy_checkout_redirect`
2. Обновите кеш модификаций: **Расширения → Модификаторы → Обновить**
3. Проверьте SEO URL на вкладке "Общие"
4. Попробуйте отключить и снова включить модуль

#### Проблема 2: Блоки не отображаются на странице

**Причины:**
- Блоки отключены в конструкторе
- Конфликт с темой оформления
- JavaScript ошибки на странице

**Решение:**
1. Проверьте статус блоков на вкладке **"Конструктор страницы"**
2. Убедитесь, что блоки имеют правильную позицию
3. Откройте консоль браузера (F12) и проверьте наличие JavaScript ошибок
4. Попробуйте временно отключить пользовательский JavaScript на вкладке "Javascript"
5. Проверьте совместимость с вашей темой

#### Проблема 3: Маска телефона не работает

**Причины:**
- Тип маски установлен в "Отключено"
- Библиотека Maska.js не загружается
- Конфликт с другими скриптами

**Решение:**
1. Проверьте тип маски на вкладке **"Общие"** → должен быть "Статическая" или "Динамическая"
2. Убедитесь, что файл `/catalog/view/javascript/aw_easy_checkout/maska.min.js` существует
3. Откройте консоль браузера (F12) и проверьте загрузку скрипта
4. Проверьте правильность формата маски (токены `#`, `@`, `*`)

#### Проблема 4: Не отображаются способы доставки

**Причины:**
- Способы доставки не настроены в OpenCart
- Не выбраны страна и регион
- Способы доставки отфильтрованы по странам
- Превышен максимальный вес или сумма заказа

**Решение:**
1. Проверьте, что способы доставки установлены и включены: **Расширения → Доставка**
2. Убедитесь, что поля "Страна" и "Регион" включены и обязательны
3. Проверьте фильтры по странам на вкладке **"Способы доставки"**
4. Проверьте настройки геозон для способов доставки
5. Убедитесь, что вес и размеры товаров не превышают лимиты

#### Проблема 5: Не отображаются способы оплаты

**Причины:**
- Способы оплаты не настроены
- Ограничение по типу пользователя (гость/авторизация)
- Ограничение по способу доставки
- Не выполнены условия минимальной суммы заказа

**Решение:**
1. Проверьте, что способы оплаты установлены и включены: **Расширения → Оплата**
2. Проверьте настройки видимости на вкладке **"Способы оплаты"**:
   - Доступен ли для гостей/авторизованных пользователей
   - Совместим ли с выбранным способом доставки
3. Убедитесь, что сумма заказа превышает минимум для способа оплаты

#### Проблема 6: Произвольные поля не сохраняются в заказе

**Причины:**
- Опция "Сохранять значение поля в комментарий к заказу" отключена
- Поле необязательное и не заполнено
- Ошибка валидации поля

**Решение:**
1. Откройте настройки произвольного поля
2. Включите опцию **"Сохранять значение поля в комментарий к заказу"**
3. Проверьте, что поле заполняется на фронтенде
4. Проверьте корректность regex валидации

#### Проблема 7: JavaScript код не выполняется

**Причины:**
- Синтаксическая ошибка в коде
- Конфликт с другими скриптами
- jQuery не загружен

**Решение:**
1. Откройте консоль браузера (F12) → вкладка "Console"
2. Проверьте наличие ошибок в красном цвете
3. Исправьте синтаксические ошибки
4. Оберните код в:
   ```javascript
   $(document).ready(function() {
       // Ваш код
   });
   ```

#### Проблема 8: Импорт настроек не работает

**Причины:**
- Файл поврежден или неправильного формата
- Недостаточно прав у пользователя
- Несовместимость версий модуля

**Решение:**
1. Убедитесь, что импортируете файл, экспортированный модулем Easy Checkout
2. Проверьте, что файл имеет расширение `.json`
3. Откройте файл в текстовом редакторе и убедитесь, что это валидный JSON
4. Войдите под учетной записью с правами администратора
5. Попробуйте экспортировать и сразу импортировать для проверки

#### Проблема 9: Страница checkout отображается некорректно

**Причины:**
- Конфликт CSS стилей с темой
- Неправильная ширина колонок
- Отсутствуют CSS файлы модуля

**Решение:**
1. Проверьте, что файлы CSS загружаются:
   - `/catalog/view/javascript/aw_easy_checkout/base.min.css`
   - `/catalog/view/javascript/aw_easy_checkout/select2.min.css`
2. Попробуйте включить опцию **"Использовать альтернативную тему оформления"**
3. Измените ширину колонок на вкладке **"Общие"**
4. Проверьте консоль браузера на наличие CSS ошибок

#### Проблема 10: После оформления заказа данные не сохраняются

**Причины:**
- Ошибка валидации на сервере
- Таймаут сессии
- Конфликт с другими модулями

**Решение:**
1. Проверьте логи ошибок: `system/storage/logs/error.log`
2. Убедитесь, что все обязательные поля заполнены
3. Увеличьте время жизни сессии в настройках PHP
4. Временно отключите другие модули для проверки конфликтов
5. Проверьте корректность настроек способов оплаты

### Рекомендации по использованию

#### Рекомендация 1: Настройте маску телефона
Обязательно настройте маску телефона (статическую или динамическую), чтобы номера сохранялись в едином формате.

#### Рекомендация 2: Используйте минимум обязательных полей
Не делайте обязательными поля, которые не критичны для доставки. Чем меньше полей, тем выше конверсия.

**Минимальный набор:**
- Имя
- Телефон
- Страна
- Город
- Адрес

#### Рекомендация 3: Добавьте описания к способам оплаты
Разъясняйте клиентам детали каждого способа оплаты для снижения отказов.

#### Рекомендация 4: Тестируйте на мобильных устройствах
Обязательно проверьте работу checkout на смартфонах и планшетах.

#### Рекомендация 5: Регулярно делайте экспорт настроек
Создавайте резервные копии настроек перед любыми изменениями.

#### Рекомендация 6: Используйте произвольные поля для улучшения сервиса
Добавьте поля:
- Желаемое время доставки
- Комментарий для курьера
- Код домофона
- Этаж, подъезд

#### Рекомендация 7: Настройте минимальную сумму заказа
Установите минимальную сумму заказа для оптимизации логистики и предотвращения убыточных заказов.

#### Рекомендация 8: Используйте аналитику
Добавьте отправку событий в Google Analytics через вкладку "JavaScript" для отслеживания воронки.

#### Рекомендация 9: Оптимизируйте макет под свою аудиторию
Экспериментируйте с расположением блоков. Например:
- B2C: корзина внизу, фокус на быстрое заполнение
- B2B: корзина вверху, больше полей компании

#### Рекомендация 10: Тестируйте весь процесс оформления заказа
Регулярно проходите весь процесс оформления заказа от имени покупателя для выявления проблем.

### Получение поддержки

Если вы не можете решить проблему самостоятельно:

1. **Соберите информацию:**
   - Версия OpenCart
   - Версия модуля Easy Checkout
   - Описание проблемы
   - Скриншоты ошибок
   - Содержимое файла `system/storage/logs/error.log`

2. **Проверьте документацию:**
   - Перечитайте соответствующий раздел документации
   - Проверьте FAQ на сайте автора

3. **Обратитесь в поддержку:**
   - Telegram: [@alexwaha_dev](https://t.me/alexwaha_dev)
   - Email: [support@alexwaha.com](mailto:support@alexwaha.com)
   - Bug report: [https://alexwaha.com/bug-report](https://alexwaha.com/bug-report)

> **Важно:** Техническая поддержка этого модуля доступна только на платной основе. Исправление ошибок в основном репозитории выполняется без графика, по мере наличия свободного времени у разработчика.

> **Pull Request приветствуются:** Если вы можете предложить решение какой-либо проблемы, pull-request на [GitHub](https://github.com/AlexWaha/opencart-bundle/pulls) приветствуется.

---

## Лицензия и контакты

### Лицензия

Этот проект распространяется под лицензией [GNU General Public License version 3 (GPLv3)](https://github.com/alexwaha/opencart-bundle/blob/master/LICENSE).

Права и авторство данного программного обеспечения принадлежат разработчику:
**Александр Ваховский (Oleksandr Vakhovskyi)**

Также известен как:
- Alexwaha
- Ocdev.pro

Официальный сайт: [https://alexwaha.com](https://alexwaha.com)

### Условия использования

- ✓ Свободное использование в коммерческих проектах
- ✓ Модификация кода под свои нужды
- ✓ Распространение модифицированных версий (с сохранением лицензии GPLv3)
- ✗ Удаление или изменение информации об авторе

### Отказ от ответственности

Модуль протестирован на чистой установке **OpenCart** и на стандартной теме (Default).

Автор не несет ответственности за:
- Конфликты с темами сторонних разработчиков
- Конфликты с другими модулями
- Проблемы, возникшие в результате модификации кода модуля
- Потерю данных в результате неправильного использования

> **Рекомендация:** Всегда тестируйте модуль на тестовом сервере перед установкой на рабочем сайте.

### Платная поддержка

Настройка модуля автором, кастомизация, решение конфликтов с другими модулями, интеграция с шаблоном, интеграция с другим модулем в вашем проекте - только на **платной основе**.

**Услуги:**
- Установка и настройка модуля
- Интеграция с дизайном сайта
- Решение конфликтов с другими расширениями
- Доработка функционала под ваши требования
- Консультации по использованию

### Контакты

**Telegram:**
[@alexwaha_dev](https://t.me/alexwaha_dev)

**Email:**
[support@alexwaha.com](mailto:support@alexwaha.com)

**Сообщить об ошибке:**
[https://alexwaha.com/bug-report](https://alexwaha.com/bug-report)

**GitHub:**
[https://github.com/AlexWaha/opencart-bundle](https://github.com/AlexWaha/opencart-bundle)

---

### Благодарности

Спасибо всем пользователям модуля за обратную связь, сообщения об ошибках и предложения по улучшению!

---

**Alexwaha.com - Easy Checkout для OpenCart**

---
